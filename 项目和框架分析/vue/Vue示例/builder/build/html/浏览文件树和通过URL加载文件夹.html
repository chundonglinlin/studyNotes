

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. 浏览文件树和通过URL加载文件夹 &mdash; Vue示例 1.0 文档</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="索引"
              href="genindex.html"/>
        <link rel="search" title="搜索" href="search.html"/>
    <link rel="top" title="Vue示例 1.0 文档" href="index.html"/>
        <link rel="next" title="7. 使用Vuex缓存当前文件夹结构" href="使用Vuex缓存当前文件夹结构.html"/>
        <link rel="prev" title="5. 使用Dropbox API获取文件列表" href="使用Dropbox_API获取文件列表.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Vue示例
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="前言.html">1. 前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vue入门.html">2. Vue入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="显示、循环、查询和过滤数据.html">3. 显示、循环、查询和过滤数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="优化你的App和使用组件显示数据.html">4. 优化你的App和使用组件显示数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="使用Dropbox_API获取文件列表.html">5. 使用Dropbox API获取文件列表</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. 浏览文件树和通过URL加载文件夹</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">6.1. 分离文件和文件夹</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">6.2. 创建文件和文件夹组件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">6.3. 链接文件夹并更新结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">6.4. 创建当前路径的面包屑</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">6.5. 添加下载文件功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">6.6. 更新URL哈希并使用它来浏览文件夹</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">6.6.1. 基于URL显示文件夹</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">6.6.2. 显示一个错误消息</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">6.6.3. 在浏览器中使用后退和前进按钮</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">6.7. 最终代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">6.8. 总结</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="使用Vuex缓存当前文件夹结构.html">7. 使用Vuex缓存当前文件夹结构</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Vue示例</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>6. 浏览文件树和通过URL加载文件夹</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/浏览文件树和通过URL加载文件夹.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="url">
<h1>6. 浏览文件树和通过URL加载文件夹<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h1>
<p>在第4章“使用 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">API</span></code> 获取文件列表”中，我们创建了一个列出指定 <code class="docutils literal"><span class="pre">Dropbox</span></code> 文件夹的文件和文件夹内容的应用程序。我们现在需要让我们的应用程序易于浏览。 这意味着用户将能够单击文件夹名称来导航并列出其中的内容，并使用户能够下载该文件。</p>
<p>在继续之前，请确保您的 <code class="docutils literal"><span class="pre">HTML</span></code> 中包含 <code class="docutils literal"><span class="pre">Vue</span></code> 和 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">JavaScript</span></code> 文件。</p>
<p>在本章中，我们将是：</p>
<ul class="simple">
<li>为文件和文件夹创建组件；</li>
<li>向文件夹组件添加链接以更新目录列表；</li>
<li>将下载按钮添加到文件组件；</li>
<li>创建一个面包屑组件，以便用户可以轻松导航到树；</li>
<li>动态更新浏览器 <code class="docutils literal"><span class="pre">URL</span></code> ，因此如果文件夹作为书签或共享链接，文件夹能被正确的加载；</li>
</ul>
<div class="section" id="id1">
<h2>6.1. 分离文件和文件夹<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>在我们创建组件之前，我们需要在我们的结构中分离我们的文件和文件夹，以便我们可以轻松识别和显示我们的不同类型。感谢每个项中的 <code class="docutils literal"><span class="pre">.tag</span></code> 属性，我们可以分割我们的文件夹和文件。</p>
<p>首先，我们需要将我们的 <code class="docutils literal"><span class="pre">structure</span></code> 数据属性更新为包含 <code class="docutils literal"><span class="pre">files</span></code> 和 <code class="docutils literal"><span class="pre">folders</span></code> 数组的对象：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">accessToken</span><span class="o">:</span> <span class="s1">&#39;XXXX&#39;</span><span class="p">,</span>
        <span class="nx">structure</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">files</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">folders</span><span class="o">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="nx">byteSizes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">],</span>
        <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这使我们能够将我们的文件和文件夹附加到不同的数组，这意味着我们可以在我们的视图中以不同的方式显示它们。</p>
<p>下一步是用当前文件夹的数据填充这些数组。以下所有代码都发生在 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法的第一个 <code class="docutils literal"><span class="pre">then()</span></code> 函数中。</p>
<p>创建一个 JavaScript 循环来遍历条目并检查项目的 <code class="docutils literal"><span class="pre">.tag</span></code> 属性。 如果它等于 <code class="docutils literal"><span class="pre">folder</span></code> ，请将其附加到 <code class="docutils literal"><span class="pre">structure.folder</span></code> 数组，否则，将其添加到 <code class="docutils literal"><span class="pre">structure.files</span></code> 数组中：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">structure</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">},</span>
</pre></div>
</div>
<p>此代码循环显示条目，如同我们在视图中一样，并检查 <code class="docutils literal"><span class="pre">.tag</span></code> 属性。 由于属性本身以 <code class="docutils literal"><span class="pre">.</span></code> 开头，因此我们无法像使用对象样式表示法那样访问属性，例如，对于 <code class="docutils literal"><span class="pre">name</span></code> - <code class="docutils literal"><span class="pre">entry.name</span></code> 。然后，我们使用 JavaScript <code class="docutils literal"><span class="pre">push</span></code> 将条目追加到文件或文件夹数组中。</p>
<p>为了显示这个新数据，我们需要更新视图以循环两种类型的数组。
这是使用 <code class="docutils literal"><span class="pre">&lt;template&gt;</span></code> 标记的完美用例，因为我们希望将这两个数组追加到同一个无序列表中。</p>
<p>更新视图以分别列出两个数组。我们可以从文件夹显示部分删除大小选项，因为它永远不会使用大小属性：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>&lt;ul v-if=&quot;!isLoading&quot;&gt;
    &lt;template v-for=&quot;entry in structure.folders&quot;&gt;
        &lt;li&gt;
            &lt;strong&gt;{{entry.name }}&lt;/strong&gt;
        &lt;/li&gt;
    &lt;/template&gt;
    &lt;template v-for=&quot;entry in structure.files&quot;&gt;
        &lt;li&gt;
            &lt;strong&gt;{{ entry.name }}&lt;/strong&gt;
            &lt;span v-if=&quot;entry.size&quot;&gt;- {{ bytesToSize(entry.size) }}&lt;/span&gt;
        &lt;/li&gt;
    &lt;/template&gt;
&lt;/ul&gt;
</pre></div>
</div>
<p>现在，我们有机会为这两种类型创建组件。</p>
</div>
<div class="section" id="id2">
<h2>6.2. 创建文件和文件夹组件<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>随着我们的数据类型分离出来，我们可以创建单独的组件来划分数据和方法。 创建一个接受单个属性的 <code class="docutils literal"><span class="pre">folder</span></code> 组件，允许传递 <code class="docutils literal"><span class="pre">folder</span></code> 对象变量。 由于模板非常小，因此不需要基于视图或 <code class="docutils literal"><span class="pre">&lt;script&gt;</span></code> 块的模板；相反，我们可以将它作为字符串传递给组件：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;{{ f.name }}&lt;/strong&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p>为了使我们的代码更小，重复性更低，道具被称为 <code class="docutils literal"><span class="pre">f</span></code> 。 这样整理视图并让组件名称决定显示类型，而不必多次重复 <code class="docutils literal"><span class="pre">folder</span></code> 单词。</p>
<p>更新视图以使用文件夹组件，并将 <code class="docutils literal"><span class="pre">entry</span></code> 变量传递给 <code class="docutils literal"><span class="pre">f</span></code> 属性：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;entry in structure.folders&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">folder</span> <span class="na">:f</span><span class="o">=</span><span class="s">&quot;entry&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">folder</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>通过创建一个 <code class="docutils literal"><span class="pre">file</span></code> 组件来重复这个过程。在创建 <code class="docutils literal"><span class="pre">file</span></code> 组件时，我们可以从父级 <code class="docutils literal"><span class="pre">dropboxviewer</span></code> 组件移动 <code class="docutils literal"><span class="pre">bytesToSize</span></code> 方法和 <code class="docutils literal"><span class="pre">byteSizes</span></code> 数据属性到本组件中，因为它只会在显示文件时使用：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;{{ f.name }}&lt;/strong&gt;&lt;span v-if=&quot;f.size&quot;&gt; - {{ bytesToSize(f.size) }}&lt;/span&gt; &lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">},</span>
    <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">byteSizes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">bytesToSize</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Set a default</span>
            <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;0 Byte&#39;</span><span class="p">;</span>
            <span class="c1">// If the bytes are bigger than 0</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Divide by 1024 and make an int</span>
                <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1024</span><span class="p">)));</span>
                <span class="c1">// Round to 2 decimal places and select the appropriate unit from the array</span>
                <span class="nx">output</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">bytes</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="nx">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">byteSizes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>再一次，我们可以使用 <code class="docutils literal"><span class="pre">f</span></code> 作为 <code class="docutils literal"><span class="pre">prop</span></code> 名称来减少重复（以及我们的应用程序的文件大小）。再次更新视图以使用这个新组件：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>&lt;template v-for=&quot;entry in structure.files&quot;&gt;
    &lt;file :f=&quot;entry&quot;&gt;&lt;/file&gt;
&lt;/template
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>6.3. 链接文件夹并更新结构<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>现在我们已将文件夹和文件分开，我们可以将文件夹名称转换为链接。 这些链接将更新结构以显示所选文件夹的内容。 为此，我们将使用每个文件夹中的 <code class="docutils literal"><span class="pre">path_lower</span></code> 属性来构建链接目标。</p>
<p>为每个文件夹 <code class="docutils literal"><span class="pre">name</span></code> 创建一个动态链接，链接到文件夹的 <code class="docutils literal"><span class="pre">path_lower</span></code> 。 随着我们对 <code class="docutils literal"><span class="pre">Vue</span></code> 越来越熟悉， <code class="docutils literal"><span class="pre">v-bind</span></code> 属性已缩短为冒号符号：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;&lt;a :href=&quot;f.path_lower&quot;&gt;{{ f.name }}&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p>我们现在需要为此链接添加 <code class="docutils literal"><span class="pre">click</span></code> 侦听器。 点击后，我们需要触发 <code class="docutils literal"><span class="pre">dropbox-viewer</span></code> 组件上的 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法。 虽然 <code class="docutils literal"><span class="pre">click</span></code> 方法将在每个实例上使用 <code class="docutils literal"><span class="pre">f</span></code> 变量来获取数据，但最好将 <code class="docutils literal"><span class="pre">href</span></code> 属性设置为文件夹 <code class="docutils literal"><span class="pre">URL</span></code> 。</p>
<p>使用我们在本书前面章节中学到的知识，在 <code class="docutils literal"><span class="pre">folder</span></code> 组件上创建一个方法，该方法在触发时将文件夹路径发送到父组件。 <code class="docutils literal"><span class="pre">dropbox-viewer</span></code> 组件还需要一个新的方法来在启动时用给定的参数更新结构。</p>
<p>在 <code class="docutils literal"><span class="pre">folder</span></code> 组件上创建新方法并将 <code class="docutils literal"><span class="pre">click</span></code> 事件添加到文件夹链接。 与 <code class="docutils literal"><span class="pre">v-bind</span></code> 指令一样，我们现在使用以 <code class="docutils literal"><span class="pre">&#64;</span></code> 符号表示的 <code class="docutils literal"><span class="pre">v-on</span></code> 的简写符号：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;&lt;a @click.prevent=&quot;navigate()&quot; :href=&quot;f.path_lower&quot;&gt;{{ f.name }}&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">navigate</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">path_lower</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>除了定义 <code class="docutils literal"><span class="pre">click</span></code> 事件之外，还添加了事件修改器。 在 <code class="docutils literal"><span class="pre">click</span></code> 事件之后使用 <code class="docutils literal"><span class="pre">.prevent</span></code> 将 <code class="docutils literal"><span class="pre">preventDefault</span></code> 添加到链接操作中，这会阻止链接实际上转到指定的 <code class="docutils literal"><span class="pre">URL</span></code> ，而是让 <code class="docutils literal"><span class="pre">click</span></code> 方法处理所有内容。更多的事件修饰符和关于它们的细节可以在 <code class="docutils literal"><span class="pre">Vue</span></code> 中找到文档。</p>
<p>单击时，会触发导航方法，该方法使用 <code class="docutils literal"><span class="pre">path</span></code> 事件发出文件夹的小写路径。</p>
<p>既然我们已经有了我们的 <code class="docutils literal"><span class="pre">click</span></code> 处理程序和变量被发射，我们需要更新视图来触发父 <code class="docutils literal"><span class="pre">Dropbox-viewer</span></code> 组件的方法：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>&lt;template v-for=&quot;entry in structure.folders&quot;&gt;
    &lt;folder :f=&quot;entry&quot; @path=&quot;updateStructure&quot;&gt;&lt;/folder&gt;
&lt;/template&gt;
</pre></div>
</div>
<p>在 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件上创建一个与 <code class="docutils literal"><span class="pre">v-on</span></code> 属性值相同的新方法，在本例中为 <code class="docutils literal"><span class="pre">updateStructure</span></code> 。这个方法将有一个参数，这是我们之前发射的路径。 从这里，我们可以使用路径变量来触发原始的 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">updateStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在浏览器中查看我们的应用程序现在应该列出文件夹和链接，点击后显示新文件夹的内容。</p>
<p>但是，这样做时会引发一些问题。首先，文件和文件夹被追加到现有列表中，而不是替换它。其次，没有反馈给用户该应用正在加载下一个文件夹。</p>
<p>第一个问题可以通过在追加新结构之前清除文件夹和文件数组来解决。第二个可以通过利用我们在应用程序开始时使用的加载屏幕来解决 - 这会给用户一些反馈。</p>
<p>要解决第一个问题，请在 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法的 <code class="docutils literal"><span class="pre">promise</span></code> 成功函数内创建一个新的 <code class="docutils literal"><span class="pre">structure</span></code> 对象。该对象应该复制数据对象中的 <code class="docutils literal"><span class="pre">structure</span></code> 对象。这应该为文件和文件夹设置空白数组。更新 <code class="docutils literal"><span class="pre">for</span></code> 循环以使用本地结构数组而不是组件的。最后，使用新版本更新组件 <code class="docutils literal"><span class="pre">structure</span></code> 对象，包括更新的文件和文件夹：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">folders</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">files</span><span class="o">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">structure</span> <span class="o">=</span> <span class="nx">structure</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>由于该方法在应用程序挂载并创建自己的结构对象版本时被调用，因此不需要在 <code class="docutils literal"><span class="pre">data</span></code> 函数中声明数组。更新数据对象且将结构属性初始化为对象：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">accessToken</span><span class="o">:</span> <span class="s1">&#39;XXXX&#39;</span><span class="p">,</span>
        <span class="nx">structure</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>现在运行应用程序将渲染文件列表，当单击新文件夹时将清除和更新文件列表。 为了给用户一些反馈，让他们知道应用程序正在工作，让我们在每次点击后切换加载屏幕。</p>
<p>然而，在我们这样做之前，让我们充分了解延迟来自何处以及哪里最适合触发加载屏幕。</p>
<p>链接上的点击是即时的，这会触发文件夹组件上的导航方法，然后触发 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件上的 <code class="docutils literal"><span class="pre">updateStructure</span></code> 方法。当应用程序到达 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法内的 <code class="docutils literal"><span class="pre">Dropbox</span></code> 实例上的 <code class="docutils literal"><span class="pre">filesListFolder</span></code> 函数时，延迟就会到来。因为我们可能想在以后触发 <code class="docutils literal"><span class="pre">getFolderStucture</span></code> 方法而不触发加载屏幕，请在 <code class="docutils literal"><span class="pre">updateStructure</span></code> 方法中将 <code class="docutils literal"><span class="pre">isLoading</span></code> 变量设置为 <code class="docutils literal"><span class="pre">true</span></code> ：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">updateStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>使用动画后，在浏览文件夹时，应用程序会在加载屏幕和文件夹结构之间淡出。</p>
</div>
<div class="section" id="id4">
<h2>6.4. 创建当前路径的面包屑<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>在浏览文件夹或任何类型的嵌套结构时，可以使用面包屑总是很好的，这样用户就知道他们在哪里，他们走了多远，还可以轻松地返回到上一个文件夹。我们将为面包屑创建一个组件，因为它将包含各种属性，计算函数和方法。</p>
<p>面包屑组件会将每个文件夹深度列出为文件夹图标的链接。点击链接会将用户直接带到该文件夹 - 即使它有几层。为了达到这个目的，我们需要有一个我们可以循环的链接列表，每个链接都有两个属性 - 一个是文件夹的完整路径，另一个是文件夹名称。</p>
<p>例如，如果我们有 <code class="docutils literal"><span class="pre">/images/holiday/summer/iphone</span></code> 的文件夹结构，我们希望能够点击 <code class="docutils literal"><span class="pre">holiday</span></code> 并导航到 <code class="docutils literal"><span class="pre">/images/holiday</span></code> 。</p>
<p>现在创建你的面包屑组件 - 向模板属性添加一个空的 <code class="docutils literal"><span class="pre">&lt;div&gt;</span></code> ：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;breadcrumb&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&lt;/div&gt;&#39;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>将组件添加到您的视图。我们希望 <code class="docutils literal"><span class="pre">breadcrumb</span></code> 在结构列表中淡入淡出，所以我们需要调整 <code class="docutils literal"><span class="pre">HTML</span></code> 以将列表和面包屑组件包装在具有 <code class="docutils literal"><span class="pre">v-if</span></code> 声明的容器中：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>&lt;transition name=&quot;fade&quot;&gt;
    &lt;div v-if=&quot;!isLoading&quot;&gt;
        &lt;breadcrumb&gt;&lt;/breadcrumb&gt;
        &lt;ul&gt;
            &lt;template v-for=&quot;entry in structure.folders&quot;&gt;
                &lt;folder :f=&quot;entry&quot; @path=&quot;updateStructure&quot;&gt; &lt;/folder&gt;
            &lt;/template&gt;
            &lt;template v-for=&quot;entry in structure.files&quot;&gt;
                &lt;file :f=&quot;entry&quot;&gt;&lt;/file&gt;
            &lt;/template&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/transition&gt;
</pre></div>
</div>
<p>我们现在需要为我们提供一个存储当前文件夹路径的变量。 然后我们可以在面包屑组件中操作这个变量。 这将在 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件上存储和更新，并传递给 <code class="docutils literal"><span class="pre">breadcrumb</span></code> 组件。 在 <code class="docutils literal"><span class="pre">dropbox-viewer</span></code> 组件上创建一个名为 <code class="docutils literal"><span class="pre">path</span></code> 的新属性：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">accessToken</span><span class="o">:</span> <span class="s1">&#39;XXXXX&#39;</span><span class="p">,</span>
        <span class="nx">structure</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>我们现在需要确保每当从 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">API</span></code> 检索结构时都会更新此路径。 在 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法内在 <code class="docutils literal"><span class="pre">isLoading</span></code> 变量被禁用之前执行此操作。 这可确保只有在结构加载完成后以及文件和文件夹显示之前才会更新它：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">folders</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">files</span><span class="o">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">structure</span> <span class="o">=</span> <span class="nx">structure</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">},</span>
</pre></div>
</div>
<p>现在我们有一个用当前路径填充的变量，我们可以将它作为 <code class="docutils literal"><span class="pre">prop</span></code> 传递给面包屑组件。 添加一个新的属性到 <code class="docutils literal"><span class="pre">path</span></code> 变量作为值的面包屑：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">breadcrumb</span> <span class="na">:p</span><span class="o">=</span><span class="s">&quot;path&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">breadcrumb</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>更新组件以接受 <code class="docutils literal"><span class="pre">prop</span></code> 作为字符串：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;breadcrumb&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&lt;/div&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">p</span><span class="o">:</span> <span class="nb">String</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">p</span></code> 属性现在包含我们所在的完整路径（例如 <code class="docutils literal"><span class="pre">/images/holiday/summer</span></code> ）。 我们想分解这个字符串，以便我们可以识别文件夹名称并为组件渲染构建面包屑。</p>
<p>在组件上创建一个计算对象并创建一个名为 <code class="docutils literal"><span class="pre">folders()</span></code> 的新函数。 这将为我们创建面包屑数组以在模板中循环访问：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>我们现在需要设置一些变量供我们使用。 创建一个名为 <code class="docutils literal"><span class="pre">output</span></code> 的新的空数组。 这是我们要建立我们的面包屑的地方。我们还需要一个名为 <code class="docutils literal"><span class="pre">slug</span></code> 的空字符串变量。 <code class="docutils literal"><span class="pre">slug</span></code> 变量指的是 <code class="docutils literal"><span class="pre">URL</span></code> 的一部分，其使用受 <code class="docutils literal"><span class="pre">WordPress</span></code> 的欢迎。 最后一个变量是作为数组创建的路径。正如我们所知道的，每个文件夹都被一个 <code class="docutils literal"><span class="pre">/</span></code> 分开，我们可以使用它来分解或分割字符串到不同的部分：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">slug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">parts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果我们要查看 <code class="docutils literal"><span class="pre">Summer&quot;&quot;</span></code> 文件夹的部分变量，它将如下所示：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;summer&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>我们现在可以遍历数组来创建面包屑。 每个面包屑项目将成为具有单个文件夹 <code class="docutils literal"><span class="pre">name</span></code>  的对象，例如 <code class="docutils literal"><span class="pre">holiday</span></code> 或 <code class="docutils literal"><span class="pre">summer</span></code> ，以及 <code class="docutils literal"><span class="pre">slug</span></code> ，前者为 <code class="docutils literal"><span class="pre">/images/holiday/</span></code> 后者为 <code class="docutils literal"><span class="pre">/images/holiday/summer</span></code> 。</p>
<p>每个对象都将被构造并添加到 <code class="docutils literal"><span class="pre">output</span></code> 数组中。 然后我们可以返回供我们的模板使用的 <code class="docutils literal"><span class="pre">output</span></code> ：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">slug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">parts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">parts</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">slug</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="nx">item</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="o">:</span> <span class="nx">slug</span><span class="p">});</span>
        <span class="nx">slug</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>此循环通过执行以下步骤来创建我们的面包屑。对于这个例子，我们假设我们在 <code class="docutils literal"><span class="pre">/images/holiday</span></code> 文件夹中：</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">parts</span></code> 现在将成为一个包含三个项目的数组，[‘’，’images’，’holiday’]。如果您分割的字符串从您要分割的项目开始，则会将空项目作为第一项。</li>
<li>在循环开始时，第一个 <code class="docutils literal"><span class="pre">slug</span></code> 变量将等于 <code class="docutils literal"><span class="pre">''</span></code> ，因为它是第一个项目。</li>
<li><code class="docutils literal"><span class="pre">output</span></code> 数组将在最后一个位置添加一个新项目，即 <code class="docutils literal"><span class="pre">{'name':''，'path':''}</span></code> 的对象。</li>
<li><code class="docutils literal"><span class="pre">slug</span></code> 变量然后将 <code class="docutils literal"><span class="pre">/</span></code> 添加到最后。</li>
<li>循环到下一个项目， <code class="docutils literal"><span class="pre">slug</span></code> 变量添加当前项( <code class="docutils literal"><span class="pre">images</span></code> )的名称。</li>
<li>现在输出添加了一个新对象，值为 <code class="docutils literal"><span class="pre">{'name':'images'，'path':'/images'}</span></code> 。</li>
<li>对于最后一个项，另一个 <code class="docutils literal"><span class="pre">/</span></code> 将随着下一个名称， <code class="docutils literal"><span class="pre">holiday</span></code> 一起被添加。</li>
<li><code class="docutils literal"><span class="pre">output</span></code> 获取添加的最后一个对象，值为 <code class="docutils literal"><span class="pre">{'name':'holiday'，'path':'/images/holiday'}</span></code> - 注意路径正在建立，而名称仍然是单个文件夹名称。</li>
</ol>
<p>我们现在有我们可以在视图中循环的面包屑输出数组。</p>
<p>在我们追加到输出数组之后添加斜杠的原因是， <code class="docutils literal"><span class="pre">API</span></code> 声明要获取 <code class="docutils literal"><span class="pre">Dropbox</span></code> 的根，我们传入一个空字符串，而所有其他路径必须以 <code class="docutils literal"><span class="pre">/</span></code> 开头。</p>
<p>下一步是将面包屑输出到我们的视图中。 由于这个模板很小，我们将使用多行 <code class="docutils literal"><span class="pre">JavaScript</span></code> 表示法。循环遍历 <code class="docutils literal"><span class="pre">folders</span></code> 计算变量中的项目，输出每个项的链接。 不要忘记在所有链接中保留一个包含元素：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;span v-for=&quot;f in folders&quot;&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;a :href=&quot;f.path&quot;&gt;{{ f.name }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/div&gt;&#39;</span>
</pre></div>
</div>
<p>在浏览器中渲染这个应用程序应该会显示一个面包屑 - 虽然有点挤在一起并且缺少一个 <code class="docutils literal"><span class="pre">home</span></code> 链接（因为第一个项没有名称）。回到 <code class="docutils literal"><span class="pre">folders</span></code> 函数并添加一条 <code class="docutils literal"><span class="pre">if</span></code> 语句 - 检查该条目是否有名称，如果不是，则添加一个硬编码值：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">slug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">parts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">parts</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">parts</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">slug</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="nx">item</span> <span class="o">||</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="o">:</span> <span class="nx">slug</span><span class="p">});</span>
        <span class="nx">slug</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>另一种选择是在模板本身中添加 <code class="docutils literal"><span class="pre">if</span></code> 语句：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;span v-for=&quot;f in folders&quot;&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;a :href=&quot;f.path&quot;&gt;{{ f.name || &#39;</span><span class="nx">Home</span><span class="s1">&#39; }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/div&gt;&#39;</span>
</pre></div>
</div>
<p>如果我们想要在文件夹名称之间显示一个分隔符，例如斜杠或 <code class="docutils literal"><span class="pre">&gt;</span></code> 形符号，这可以轻松添加。但是，当我们想在链接之间显示分隔符时，会出现一个小小的障碍，但不会在开始或结束时显示。为了解决这个问题，我们将在循环中利用可用的 <code class="docutils literal"><span class="pre">index</span></code> 关键字。 然后我们将这个与数组长度进行比较，并对元素进行 <code class="docutils literal"><span class="pre">v-if</span></code> 声明。</p>
<p>在循环数组时， <code class="docutils literal"><span class="pre">Vue</span></code> 允许您使用另一个变量。 这是默认情况下的索引（数组中项目的位置）；但是，如果您的数组以键/值方式构造，则索引可能会设置为一个值。 如果是这种情况，您仍然可以通过添加第三个变量来访问索引。 由于我们的数组是一个简单的列表，我们可以轻松使用这个变量：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;span v-for=&quot;(f, i) in folders&quot;&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;a :href=&quot;f.path&quot;&gt;{{ f.name || &#39;</span><span class="nx">Home</span><span class="s1">&#39; }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;span v-if=&quot;i !== (folders.length - 1)&quot;&gt; »</span>
<span class="s1">        &lt;/span&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>将 <code class="docutils literal"><span class="pre">f</span></code> 变量更新为一对包含 <code class="docutils literal"><span class="pre">f</span></code> 和 <code class="docutils literal"><span class="pre">i</span></code> 的括号，逗号分隔。
<code class="docutils literal"><span class="pre">f</span></code> 变量是循环中的当前文件夹，而已创建的变量 <code class="docutils literal"><span class="pre">i</span></code> 是该项目的索引。 请记住，数组索引从 0 开始而不是 1 。</p>
<p>我们添加的分隔符包含在带有 <code class="docutils literal"><span class="pre">v-if</span></code> 属性的 <code class="docutils literal"><span class="pre">span</span></code> 标签中，其中的内容可能看起来很混乱。这会使当前索引与 <code class="docutils literal"><span class="pre">folder</span></code> 数组的长度（有多少项）减 1 相混淆。 -1 是因为索引从 0 开始，而不是 1 ，正如您所期望的那样。如果数字不匹配，则会显示 <code class="docutils literal"><span class="pre">span</span></code> 元素。</p>
<p>我们需要做的最后一件事是让我们的面包屑导航到选定的文件夹。 我们可以通过调整我们为 <code class="docutils literal"><span class="pre">folder</span></code> 组件编写的导航功能来做到这一点。</p>
<p>但是，因为我们的整个组件都是面包屑而不是每个单独的链接，所以我们需要对其进行修改，以便接受参数。</p>
<p>通过将 <code class="docutils literal"><span class="pre">click</span></code> 事件添加到链接开始，传入 <code class="docutils literal"><span class="pre">folder</span></code> 对象：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;span v-for=&quot;(f, i) in folders&quot;&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;a @click.prevent=&quot;navigate(f)&quot; :href=&quot;f.path&quot;&gt; {{ f.name || &#39;</span><span class="nx">Home</span><span class="s1">&#39; }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;i v-if=&quot;i !== (folders.length - 1)&quot;&gt; &amp;raquo; &lt;/i&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>接下来，在面包屑组件上创建导航方法，确保接受文件夹参数并发出路径：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">navigate</span><span class="p">(</span><span class="nx">folder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="nx">folder</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>最后一步是在路径被发送时触发父方法。 为此，我们可以在 <code class="docutils literal"><span class="pre">dropbox-viewer</span></code> 组件上使用相同的 <code class="docutils literal"><span class="pre">updateStructure</span></code> 方法：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>&lt;breadcrumb :p=&quot;path&quot; @path=&quot;updateStructure&quot;&gt;&lt;/breadcrumb&gt;
</pre></div>
</div>
<p>我们现在有一个完全可操作的面包屑导航，它允许用户使用文件夹链接浏览文件夹结构并通过面包屑链接备份。</p>
<p>我们的完整的面包屑组件看起来像是：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;breadcrumb&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;span v-for=&quot;(f, i) in folders&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;a @click.prevent=&quot;navigate(f)&quot; :href=&quot;f.path&quot;&gt;{{ f.name || &#39;</span><span class="nx">Home</span><span class="s1">&#39; }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;i v-if=&quot;i !== (folders.length - 1)&quot;&gt; » &lt;/i&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">p</span><span class="o">:</span> <span class="nb">String</span>
    <span class="p">},</span>
    <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="nx">slug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">parts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">parts</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">parts</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">slug</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">;</span>
                <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="nx">item</span> <span class="o">||</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="o">:</span> <span class="nx">slug</span><span class="p">});</span>
                <span class="nx">slug</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">navigate</span><span class="p">(</span><span class="nx">folder</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="nx">folder</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>6.5. 添加下载文件功能<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>现在我们的用户可以浏览文件夹结构，我们需要添加下载文件的功能。 不幸的是，这并不像访问文件上的链接属性那么简单。 要获得下载链接，我们必须为每个文件查询 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">API</span></code> 。</p>
<p>我们将在创建文件组件时查询 <code class="docutils literal"><span class="pre">API</span></code> ，这将异步获取下载链接，并显示一次可用的链接。 在我们做这件事之前，我们需要让 <code class="docutils literal"><span class="pre">Dropbox</span></code> 实例对文件组件可用。</p>
<p>向视图中的文件组件添加一个新属性，并将 <code class="docutils literal"><span class="pre">Dropbox</span></code> 方法作为值传入：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">file</span> <span class="na">:d</span><span class="o">=</span><span class="s">&quot;dropbox()&quot;</span> <span class="na">:f</span><span class="o">=</span><span class="s">&quot;entry&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">file</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>将 <code class="docutils literal"><span class="pre">d</span></code> 变量作为对象添加到接受组件的 <code class="docutils literal"><span class="pre">props</span></code> 对象中：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="nx">d</span><span class="o">:</span> <span class="nb">Object</span>
<span class="p">},</span>
</pre></div>
</div>
<p>我们现在要添加 <code class="docutils literal"><span class="pre">link</span></code> 到数据属性。这应该在默认情况下设置为 <code class="docutils literal"><span class="pre">false</span></code> ，因此我们可以隐藏链接，并且一旦 <code class="docutils literal"><span class="pre">API</span></code> 返回值，我们就会用它填充下载链接。</p>
<p>将 <code class="docutils literal"><span class="pre">created()</span></code> 函数添加到文件组件，并在里面添加 <code class="docutils literal"><span class="pre">API</span></code> 调用：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">filesGetTemporaryLink</span><span class="p">({</span><span class="nx">path</span><span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">path_lower</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">link</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">link</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这个 <code class="docutils literal"><span class="pre">API</span></code> 方法接受一个对象，类似于 <code class="docutils literal"><span class="pre">filesListFolder</span></code> 函数。 我们正在传递当前文件的路径。数据返回后，我们可以将组件的 <code class="docutils literal"><span class="pre">link</span></code> 属性设置为下载链接。</p>
<p>我们现在可以添加一个下载链接到组件的模板。 添加 <code class="docutils literal"><span class="pre">v-if</span></code> ，只有在检索到下载链接后才显示 <code class="docutils literal"><span class="pre">&lt;a&gt;</span></code> ：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>template: &#39;<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ f.name }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">vif</span><span class="o">=</span><span class="s">&quot;f.size&quot;</span><span class="p">&gt;</span> - {{ bytesToSize(f.size) }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span>  <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;link&quot;</span><span class="p">&gt;</span> - <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&quot;link&quot;</span><span class="p">&gt;</span>Download<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>&#39;
</pre></div>
</div>
<p>通过浏览文件，我们现在可以在每个文件旁边看到一个下载链接，其速度取决于您的互联网连接和 <code class="docutils literal"><span class="pre">API</span></code> 速度。添加下载链接的完整文件组件现在看起来如下所示：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;{{ f.name }}&lt;/strong&gt;&lt;span vif=&quot;f.size&quot;&gt; - {{ bytesToSize(f.size) }}&lt;/span&gt;&lt;span v-if=&quot;link&quot;&gt; - &lt;a :href=&quot;link&quot;&gt;Download&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
            <span class="nx">d</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">},</span>
    <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">byteSizes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">],</span>
            <span class="nx">link</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">bytesToSize</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Set a default</span>
            <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;0 Byte&#39;</span><span class="p">;</span>
            <span class="c1">// If the bytes are bigger than 0</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Divide by 1024 and make an int</span>
                <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="o">/</span>
                    <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1024</span><span class="p">)));</span>
                <span class="c1">// Round to 2 decimal places and select the appropriate unit from the array</span>
                <span class="nx">output</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">bytes</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="nx">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">byteSizes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">filesGetTemporaryLink</span><span class="p">({</span><span class="nx">path</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">path_lower</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">link</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">link</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2>6.6. 更新URL哈希并使用它来浏览文件夹<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>通过我们的 <code class="docutils literal"><span class="pre">Dropbox</span></code> 网络应用，现在可以通过结构列表和面包屑完全导航，我们现在可以添加和更新浏览器 <code class="docutils literal"><span class="pre">URL</span></code> 以便快速访问和共享文件夹。我们可以通过两种方式做到这一点：我们可以更新散列，例如 <code class="docutils literal"><span class="pre">www.domain.com/#/images/holiday/summer</span></code> ，或者我们可以将所有路径重定向到单个页面，并在URL中没有散列的情况下处理路由。</p>
<p>对于这个应用程序，我们将使用 <code class="docutils literal"><span class="pre">URL</span></code> 中的 <code class="docutils literal"><span class="pre">＃</span></code> 方法。在介绍 <code class="docutils literal"><span class="pre">vue-router</span></code> 时，我们将在本书的第三部分介绍 <code class="docutils literal"><span class="pre">URL</span></code> 路由技术。</p>
<p>在我们获取应用程序以显示 <code class="docutils literal"><span class="pre">URL</span></code> 的相应​​文件夹之前，我们首先需要在导航到新文件夹时获取要更新的 <code class="docutils literal"><span class="pre">URL</span></code> 。我们可以使用本地的 <code class="docutils literal"><span class="pre">window.location.hash</span></code> JavaScript对象来做到这一点。我们希望在用户点击链接后立即更新网址，而不是等待数据加载进行更新。</p>
<p>由于 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 方法在我们更新结构时被触发，请将代码添加到此函数的顶部。这将意味着 <code class="docutils literal"><span class="pre">URL</span></code> 得到更新，然后调用 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">API</span></code> 来更新结构：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span> <span class="c1">// 更新浏览器地址</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">folders</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">files</span><span class="o">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">structure</span> <span class="o">=</span> <span class="nx">structure</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>您可以浏览您的应用程序，它应该更新 <code class="docutils literal"><span class="pre">URL</span></code> 以包含当前文件夹路径。</p>
<p>但是，当您在文件夹中刷新时会发现 <code class="docutils literal"><span class="pre">URL</span></code> 被重置为通过 <code class="docutils literal"><span class="pre">created()</span></code> 函数中的方法传入的空路径，所以 <code class="docutils literal"><span class="pre">URL</span></code> 重置为哈希后面没有文件夹的情况。</p>
<p>我们可以通过将当前哈希传递给创建的函数中的 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 来弥补这一点，但是，如果我们这样做，将会有一些检查和错误捕获。</p>
<p>首先，当调用 <code class="docutils literal"><span class="pre">window.location.hash</span></code> 时，你也会得到散列作为字符串的一部分返回，所以我们需要删除它。 其次，如果用户输入错误的路径或文件夹被移动，我们需要处理正确 <code class="docutils literal"><span class="pre">URL</span></code> 的实例。 最后，我们需要让用户在其浏览器中使用后退和前进按钮（或键盘快捷键）。</p>
<div class="section" id="id7">
<h3>6.6.1. 基于URL显示文件夹<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>当我们的应用程序挂载时，它已经调用了一个函数来请求基础文件夹的结构。在 <code class="docutils literal"><span class="pre">created()</span></code> 函数中，我们已经将该值固定为空的根文件夹，所以我们重新编写这个函数来允许路径被传入。 这使我们能够传递包含散列的URL参数而不是固定字符串来灵活地调整此函数。</p>
<p>更新函数以接受 <code class="docutils literal"><span class="pre">URL</span></code> 的散列，如果没有，则使用原始固定字符串：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">hash</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>创建一个名为 <code class="docutils literal"><span class="pre">hash</span></code> 的新变量并将 <code class="docutils literal"><span class="pre">window.location.hash</span></code> 赋值给它。 因为我们的应用程序不需要该以 <code class="docutils literal"><span class="pre">#</span></code> 开头的变量，所以使用 <code class="docutils literal"><span class="pre">substring</span></code> 函数从字符串中删除第一个字符。然后，我们可以使用一个逻辑运算符来使用散列变量，或者如果没有，则使用原始固定字符串。</p>
<p>您现在应该可以通过 <code class="docutils literal"><span class="pre">URL</span></code> 更新来浏览您的应用。 如果您随时按下刷新或将该 <code class="docutils literal"><span class="pre">URL</span></code> 复制并粘贴到其他浏览器窗口中，则应加载您所在的文件夹。</p>
</div>
<div class="section" id="id8">
<h3>6.6.2. 显示一个错误消息<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>使用我们接受网址的应用，我们需要处理某个人输错网址的情况，或者共享的文件夹已经移动的情况。</p>
<p>由于此错误是边缘情况，因此如果加载数据时出现错误，我们将劫持 <code class="docutils literal"><span class="pre">isLoading</span></code> 参数。在 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 函数中，我们有一个 <code class="docutils literal"><span class="pre">catch</span></code> 函数作为 <code class="docutils literal"><span class="pre">promise</span></code> 返回，如果API调用发生错误，它将被触发。在这个函数中，将 <code class="docutils literal"><span class="pre">isLoading</span></code> 变量设置为 <code class="docutils literal"><span class="pre">error</span></code> ：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span> <span class="c1">// 返回promise对象</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">folders</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">files</span><span class="o">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">structure</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">structure</span> <span class="o">=</span> <span class="nx">structure</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果我们需要诊断错误文件路径的问题，则使用 <code class="docutils literal"><span class="pre">console.log</span></code> 保留。虽然 <code class="docutils literal"><span class="pre">API</span></code> 可以抛出几个不同的错误，但我们将假定这个应用程序的错误是由于错误的路径。 如果您想在应用程序中处理其他错误，则可以通过其 <code class="docutils literal"><span class="pre">status_code</span></code> 属性识别错误类型。 有关这方面的更多详细信息可以在 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">API</span></code> 文档中找到。</p>
<p>更新你的视图来处理这个新的 <code class="docutils literal"><span class="pre">isLoading</span></code> 变量属性。当设置为错误时， <code class="docutils literal"><span class="pre">isLoading</span></code> 变量仍为 <code class="docutils literal"><span class="pre">true</span></code> ，因此在加载元素中添加一个新的 <code class="docutils literal"><span class="pre">v-if</span></code> 来检查加载变量是否设置为 <code class="docutils literal"><span class="pre">error</span></code> ：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>&lt;transition name=&quot;fade&quot;&gt;
    &lt;div v-if=&quot;isLoading&quot;&gt;
        &lt;div v-if=&quot;isLoading === &#39;error&#39;&quot;&gt;
            &lt;p&gt;There seems to be an issue with the URL entered.
            &lt;/p&gt;
            &lt;p&gt;&lt;a href=&quot;&quot;&gt;Go home&lt;/a&gt;&lt;/p&gt;
        &lt;/div&gt;
        &lt;div v-else&gt;
            Loading...
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/transition&gt;
</pre></div>
</div>
<p>显示isLoading变量的第一个元素被设置为 <code class="docutils literal"><span class="pre">error</span></code> ; 否则，显示加载文本。 在错误文本中，包含一个链接可将用户发送回当前 <code class="docutils literal"><span class="pre">URL</span></code> ，该路径不使用任何 <code class="docutils literal"><span class="pre">URL</span></code> 哈希。 这将“重置”它们返回到文档树的顶部，以便它们可以向下导航。 一个改进可能是打破当前的 <code class="docutils literal"><span class="pre">URL</span></code> ，并建议删除最后一个文件夹的 <code class="docutils literal"><span class="pre">URL</span></code> 。</p>
<p>通过在 <code class="docutils literal"><span class="pre">URL</span></code> 末尾添加不存在的路径并确保显示错误消息来验证错误代码是否正在加载。 请记住，如果 <code class="docutils literal"><span class="pre">Dropbox</span> <span class="pre">API</span></code> 引发任何类型的错误，则此消息将显示，您的用户可能会在此错误消息上遇到误报。</p>
</div>
<div class="section" id="id9">
<h3>6.6.3. 在浏览器中使用后退和前进按钮<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>要在我们的浏览器中使用后退和前进按钮，我们将需要更新我们的代码。目前，当用户从结构或面包屑中点击文件夹时，我们通过在我们的点击处理程序上使用 <code class="docutils literal"><span class="pre">.prevent</span></code> 来阻止浏览器的默认行为。然后，我们在处理该文件夹之前立即更新网址。</p>
<p>但是，如果我们允许应用使用本地行为更新 <code class="docutils literal"><span class="pre">URL</span></code> ，则可以观察哈希 <code class="docutils literal"><span class="pre">URL</span></code> 更新并使用它来检索我们的新结构。 使用这种方法，后退和前进按钮将无需任何进一步干预，因为它们将更新 <code class="docutils literal"><span class="pre">URL</span></code> 哈希。</p>
<p>这也将改善我们的应用程序的可读性，并减少代码的重量，因为我们可以删除链接上的 <code class="docutils literal"><span class="pre">navigate</span></code> 方法和 <code class="docutils literal"><span class="pre">click</span></code> 处理程序。</p>
<div class="section" id="id10">
<h4>6.6.3.1. 移除不需要的代码<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<p>在添加更多代码之前，第一步是从组件中删除不必要的代码。 从面包屑开始，从组件中删除 <code class="docutils literal"><span class="pre">navigate</span></code> 方法，并从模板中的链接中删除 <code class="docutils literal"><span class="pre">\&#64;click.prevent</span></code> 属性。</p>
<p>我们还需要更新每个项目的 <code class="docutils literal"><span class="pre">slug</span></code> 都前缀一个 <code class="docutils literal"><span class="pre">＃</span></code> - 这可确保应用程序不会单击时尝试导航到全新页面。当我们循环浏览文件夹计算函数中的面包屑项时，将对象推送到 <code class="docutils literal"><span class="pre">output</span></code> 数组时，将哈希添加到每个 <code class="docutils literal"><span class="pre">slug</span></code> 前面：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;breadcrumb&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;span v-for=&quot;(f, i) in folders&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;a :href=&quot;f.path&quot;&gt;{{ f.name || &#39;</span><span class="nx">Home</span><span class="s1">&#39; }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;i v-if=&quot;i !== (folders.length - 1)&quot;&gt; &amp;raquo; &lt;/i&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">p</span><span class="o">:</span> <span class="nb">String</span>
    <span class="p">},</span>
    <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="nx">slug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">parts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">parts</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">slug</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">;</span>
                <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="nx">item</span> <span class="o">||</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">slug</span><span class="p">});</span>
                <span class="nx">slug</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>我们还可以删除 <code class="docutils literal"><span class="pre">dropbox-viewer-template</span></code> 中面包屑组件的 <code class="docutils literal"><span class="pre">v-on</span></code> 声明。 它应该只将路径作为 <code class="docutils literal"><span class="pre">prop</span></code> 传入：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">breadcrumb</span> <span class="na">:p</span><span class="o">=</span><span class="s">&quot;path&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">breadcrumb</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>我们现在可以为文件夹组件重复相同的模式。从链接中删除 <code class="docutils literal"><span class="pre">&#64;</span> <span class="pre">click.prevent</span></code> 声明并删除 <code class="docutils literal"><span class="pre">navigate</span></code> 方法。</p>
<p>由于在显示文件夹对象之前我们没有循环或编辑文件夹对象，所以我们可以在模板中添加 <code class="docutils literal"><span class="pre">＃</span></code> 。 当我们告诉 <code class="docutils literal"><span class="pre">Vue</span> <span class="pre">href</span></code> 被绑定到一个JavaScript对象（带冒号）时，我们需要将这个散列封装在引号中，并使用 JavaScript <code class="docutils literal"><span class="pre">+</span></code> 符号将它与文件夹路径连接。我们已经在单引号和双引号内，所以我们需要通知JavaScript，我们的字面意思是单引号，这是通过在单引号字符前使用反斜线来完成的：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;&lt;a :href=&quot;\&#39;#\&#39; + f.path_lower&quot;&gt;{{ f.name }}&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>我们还可以从视图中的 <code class="docutils literal"><span class="pre">&lt;folder&gt;</span></code> 组件中删除 <code class="docutils literal"><span class="pre">&#64;path</span></code> 属性：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;entry in structure.folders&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">folder</span> <span class="na">:f</span><span class="o">=</span><span class="s">&quot;entry&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">folder</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>我们的代码已经看起来更干净，更简洁，文件更小。 在浏览器中查看应用程序将渲染您所在文件夹的结构; 然而，点击链接会更新 <code class="docutils literal"><span class="pre">URL</span></code> 但不会改变显示内容。</p>
</div>
<div class="section" id="urlvue">
<h4>6.6.3.2. 使用URL更改更新结构并在实例外设置Vue数据<a class="headerlink" href="#urlvue" title="永久链接至标题">¶</a></h4>
<p>现在我们已经正确地更新了 <code class="docutils literal"><span class="pre">URL</span></code> ，只要哈希值发生变化，我们就可以得到新的结构。 这可以通过 <code class="docutils literal"><span class="pre">JavaScript</span></code> 本地带有 <code class="docutils literal"><span class="pre">onhashchange</span></code> 功能的完成。</p>
<p>我们将创建一个函数，该函数在 <code class="docutils literal"><span class="pre">URL</span></code> 更新的哈希值更新时触发，而这个函数会更新父 <code class="docutils literal"><span class="pre">Vue</span></code> 实例上的路径变量。该变量将作为道具传递给子 <code class="docutils literal"><span class="pre">dropbox-viewer</span></code> 组件。 该组件将会监视变量的变化，并且在更新时它将检索新的结构。</p>
<p>首先，更新父 <code class="docutils literal"><span class="pre">Vue</span></code> 实例以使数据对象具有路径键 - 设置为空字符串属性。 我们也将把我们的 <code class="docutils literal"><span class="pre">Vue</span></code> 实例赋值给 <code class="docutils literal"><span class="pre">app</span></code> 的一个常量变量 - 这允许我们在实例之外设置数据和调用方法：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>下一步是每次 <code class="docutils literal"><span class="pre">URL</span></code> 更新时更新此数据属性。这是通过使用 <code class="docutils literal"><span class="pre">window.onhashchange</span></code> 完成的，该函数是一个本地 <code class="docutils literal"><span class="pre">JavaScript</span></code> 函数，每当 <code class="docutils literal"><span class="pre">URL</span></code> 中的哈希值发生变化时都会触发该函数。将创建的函数的哈希修饰符复制并粘贴到 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件上，然后使用该修改器修改哈希并将值存储在 <code class="docutils literal"><span class="pre">Vue</span></code> 实例上。 如果散列不存在，我们将传递一个空字符串给路径变量：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">onhashchange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hash</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>我们现在需要将此路径变量传递给 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件。 在视图中添加一个名称为 <code class="docutils literal"><span class="pre">p</span></code> 的 <code class="docutils literal"><span class="pre">prop</span></code> 变量，它的值为 <code class="docutils literal"><span class="pre">path</span></code> 变量：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;app&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dropbox-viewer</span> <span class="na">:p</span><span class="o">=</span><span class="s">&quot;path&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">dropbox-viewer</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>将 <code class="docutils literal"><span class="pre">prop</span></code> 对象添加到 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件以接受字符串：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">p</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">},</span>
</pre></div>
</div>
<p>我们现在要给 <code class="docutils literal"><span class="pre">dropbox-viewer</span></code> 组件添加一个 <code class="docutils literal"><span class="pre">watch</span></code> 函数。 该函数将观察 <code class="docutils literal"><span class="pre">p</span></code> 道具，并在更新时使用修改后的路径调用 <code class="docutils literal"><span class="pre">updateStructure()</span></code> 方法：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">p</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">updateStructure</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>回到浏览器，我们现在应该能够像以前一样浏览我们的 <code class="docutils literal"><span class="pre">Dropbox</span></code> 结构，同时使用文件夹链接和面包屑作为导航。 我们现在应该能够使用后退和前进浏览器按钮，以及任何键盘快捷键，还可以浏览文件夹。</p>
<p>在介绍第6章，使用 <code class="docutils literal"><span class="pre">Vuex</span></code> 缓存当前文件夹结构以及使用 <code class="docutils literal"><span class="pre">vuex</span></code> 引入文件夹缓存到我们的应用程序之前，我们可以对 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件进行一些优化。</p>
<p>首先，在 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 函数中，我们可以删除 <code class="docutils literal"><span class="pre">URL</span></code> 哈希被设置为路径的第一行。这是因为点击链接时 <code class="docutils literal"><span class="pre">URL</span></code> 已经更新。 从你的代码中删除这一行：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</pre></div>
</div>
<p>其次， <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件中现在有了 <code class="docutils literal"><span class="pre">this.path</span></code> 变量和 <code class="docutils literal"><span class="pre">p</span></code> 道具的重复。 消除这种情况需要稍微修改一下，因为不允许直接修改路径一样修改道具。 但是，它需要保持同步，以便可以在面包屑中正确渲染。</p>
<p>从 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件中的数据对象中删除 <code class="docutils literal"><span class="pre">path</span></code> 属性，并从 <code class="docutils literal"><span class="pre">getFolderStructure</span></code> 函数中删除 <code class="docutils literal"><span class="pre">this.path</span> <span class="pre">=</span> <span class="pre">path</span></code> 行。</p>
<p>接下来，更新 <code class="docutils literal"><span class="pre">prop</span></code> 为 <code class="docutils literal"><span class="pre">path</span></code> ，而不是 <code class="docutils literal"><span class="pre">p</span></code> 。 这也需要更新 <code class="docutils literal"><span class="pre">watch</span></code> 函数来观察 <code class="docutils literal"><span class="pre">path</span></code> 变量而不是 <code class="docutils literal"><span class="pre">p</span></code> 。</p>
<p>更新 <code class="docutils literal"><span class="pre">created</span></code> 方法以仅将 <code class="docutils literal"><span class="pre">this.path</span></code> 用作函数的参数。 <code class="docutils literal"><span class="pre">Dropbox</span></code> 组件现在应该如下所示：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;dropbox-viewer&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;#dropbox-viewer-template&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nb">String</span>
    <span class="p">},</span>
    <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">accessToken</span><span class="o">:</span> <span class="s1">&#39;XXXX&#39;</span><span class="p">,</span>
            <span class="nx">structure</span><span class="o">:</span> <span class="p">{},</span>
            <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">dropbox</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Dropbox</span><span class="p">({</span>
                <span class="nx">accessToken</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span>
                <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
                <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
            <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="kr">const</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">folders</span><span class="o">:</span> <span class="p">[],</span>
                        <span class="nx">files</span><span class="o">:</span> <span class="p">[]</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">structure</span> <span class="o">=</span> <span class="nx">structure</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">updateStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">updateStructure</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p>更新视图以接受 <code class="docutils literal"><span class="pre">prop</span></code> 作为 <code class="docutils literal"><span class="pre">path</span></code> ：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">dropbox-viewer</span> <span class="na">:path</span><span class="o">=</span><span class="s">&quot;path&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">dropbox-viewer</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>我们现在需要确保父 <code class="docutils literal"><span class="pre">Vue</span></code> 实例在页面加载和散列更改上都有正确的路径。 为了避免重复，我们将用一个方法和一个 <code class="docutils literal"><span class="pre">created</span></code> 函数来扩展我们的Vue实例。</p>
<p>保持路径变量设置为空字符串。创建一个名为 <code class="docutils literal"><span class="pre">updateHash()</span></code> 的新方法，该方法从 <code class="docutils literal"><span class="pre">window</span></code> 哈希中移除第一个字符，然后将该 <code class="docutils literal"><span class="pre">path</span></code> 变量设置为哈希或空字符串。 接下来，创建一个运行 <code class="docutils literal"><span class="pre">updateHash</span></code> 方法的 <code class="docutils literal"><span class="pre">created()</span></code> 函数。</p>
<p><code class="docutils literal"><span class="pre">Vue</span></code> 实例现在看起来像这样：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">updateHash</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hash</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">updateHash</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>最后，为了消除重复，我们可以在地址栏中的哈希值更改时触发 <code class="docutils literal"><span class="pre">updateHash</span></code> 方法：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">onhashchange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">updateHash</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2>6.7. 最终代码<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>现在我们的代码完成了您的视图， <code class="docutils literal"><span class="pre">JavaScript</span></code> 文件应该如下所示。
首先，视图应该是这样的：</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>&lt;div id=&quot;app&quot;&gt;
    &lt;dropbox-viewer :path=&quot;path&quot;&gt;&lt;/dropbox-viewer&gt;
&lt;/div&gt;
&lt;script type=&quot;text/x-template&quot; id=&quot;dropbox-viewertemplate&quot;&gt;
    &lt;div&gt;
        &lt;h1&gt;Dropbox&lt;/h1&gt;
        &lt;transition name=&quot;fade&quot;&gt;
            &lt;div v-if=&quot;isLoading&quot;&gt;
                &lt;div v-if=&quot;isLoading == &#39;error&#39;&quot;&gt;
                    &lt;p&gt;There seems to be an issue with the URL
                        entered.&lt;/p&gt;
                    &lt;p&gt;&lt;a href=&quot;&quot;&gt;Go home&lt;/a&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;div v-else&gt;
                    Loading...
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/transition&gt;
        &lt;transition name=&quot;fade&quot;&gt;
            &lt;div v-if=&quot;!isLoading&quot;&gt;
                &lt;breadcrumb :p=&quot;path&quot;&gt;&lt;/breadcrumb&gt;
                &lt;ul&gt;
                    &lt;template v-for=&quot;entry in structure.folders&quot;&gt;
                        &lt;folder :f=&quot;entry&quot;&gt;&lt;/folder&gt;
                    &lt;/template&gt;
                    &lt;template v-for=&quot;entry in structure.files&quot;&gt;
                        &lt;file :d=&quot;dropbox()&quot; :f=&quot;entry&quot;&gt;&lt;/file&gt;
                    &lt;/template&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/transition&gt;
    &lt;/div&gt;
&lt;/script&gt;
</pre></div>
</div>
<p>随附的 <code class="docutils literal"><span class="pre">JavaScript</span></code> 应用应该如下所示：</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;breadcrumb&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;span v-for=&quot;(f, i) in folders&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;a :href=&quot;f.path&quot;&gt;{{ f.name || &#39;</span><span class="nx">Home</span><span class="s1">&#39; }}&lt;/a&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;i v-if=&quot;i !== (folders.length - 1)&quot;&gt; &amp;raquo; &lt;/i&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">p</span><span class="o">:</span> <span class="nb">String</span>
    <span class="p">},</span>
    <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">folders</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="nx">slug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">parts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">parts</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">slug</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">;</span>
                <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="nx">item</span> <span class="o">||</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">slug</span><span class="p">});</span>
                <span class="nx">slug</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;&lt;a :href=&quot;\&#39;#\&#39; + f.path_lower&quot;&gt;{{ f.name }}&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;li&gt;&lt;strong&gt;{{ f.name }}&lt;/strong&gt;&lt;span v-if=&quot;f.size&quot;&gt; - {{ bytesToSize(f.size) }}&lt;/span&gt;&lt;span v-if=&quot;link&quot;&gt; - &lt;a :href=&quot;link&quot;&gt;Download&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">f</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
            <span class="nx">d</span><span class="o">:</span> <span class="nb">Object</span>
    <span class="p">},</span>
    <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">byteSizes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">],</span>
            <span class="nx">link</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">bytesToSize</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Set a default</span>
            <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;0 Byte&#39;</span><span class="p">;</span>
            <span class="c1">// If the bytes are bigger than 0</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Divide by 1024 and make an int</span>
                <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1024</span><span class="p">)));</span>
                <span class="c1">// Round to 2 decimal places and select the appropriate unit from the array</span>
                <span class="nx">output</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">bytes</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="nx">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">byteSizes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">filesGetTemporaryLink</span><span class="p">({</span><span class="nx">path</span><span class="o">:</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">path_lower</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">link</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">link</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;dropbox-viewer&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;#dropbox-viewer-template&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="nb">String</span>
    <span class="p">},</span>
    <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">accessToken</span><span class="o">:</span> <span class="s1">&#39;XXXX&#39;</span><span class="p">,</span>
            <span class="nx">structure</span><span class="o">:</span> <span class="p">{},</span>
            <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">dropbox</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Dropbox</span><span class="p">({</span>
                <span class="nx">accessToken</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">dropbox</span><span class="p">().</span><span class="nx">filesListFolder</span><span class="p">({</span>
                <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
                <span class="nx">include_media_info</span><span class="o">:</span> <span class="kc">true</span>
            <span class="p">})</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="kr">const</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">folders</span><span class="o">:</span> <span class="p">[],</span>
                        <span class="nx">files</span><span class="o">:</span> <span class="p">[]</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Check &quot;.tag&quot; prop for type</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">[</span><span class="s1">&#39;.tag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;folder&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">structure</span><span class="p">.</span><span class="nx">folders</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">structure</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">structure</span> <span class="o">=</span> <span class="nx">structure</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">;</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">updateStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">getFolderStructure</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">updateStructure</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">updateHash</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hash</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">updateHash</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">onhashchange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">updateHash</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2>6.8. 总结<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<p>我们现在有一个功能齐全的 <code class="docutils literal"><span class="pre">Dropbox</span></code> 查看器应用程序，其中包含文件夹导航和文件下载链接。 我们可以使用文件夹链接或面包屑导航并使用后退或前进按钮。 我们还可以共享或收藏链接并加载该文件夹的内容。</p>
<p>在第6章缓存当前文件夹结构使用 <code class="docutils literal"><span class="pre">Vuex</span></code> ，我们将通过使用 <code class="docutils literal"><span class="pre">Vuex</span></code> 缓存当前文件夹内容来加快导航过程。</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="使用Vuex缓存当前文件夹结构.html" class="btn btn-neutral float-right" title="7. 使用Vuex缓存当前文件夹结构" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="使用Dropbox_API获取文件列表.html" class="btn btn-neutral" title="5. 使用Dropbox API获取文件列表" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, lzh.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            LANGUAGE:'zh_CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>