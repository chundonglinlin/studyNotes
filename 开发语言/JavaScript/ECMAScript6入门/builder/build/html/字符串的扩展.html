

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. 字符串的扩展 &mdash; ECMAScript6入门 1.0 文档</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="索引"
              href="genindex.html"/>
        <link rel="search" title="搜索" href="search.html"/>
    <link rel="top" title="ECMAScript6入门 1.0 文档" href="index.html"/>
        <link rel="next" title="6. 正则的扩展" href="正则的扩展.html"/>
        <link rel="prev" title="4. 变量的解构赋值" href="变量的解构赋值.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ECMAScript6入门
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="前言.html">1. 前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="ECMAScript6简介.html">2. ECMAScript6简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="let和const命令.html">3. let 和 const 命令</a></li>
<li class="toctree-l1"><a class="reference internal" href="变量的解构赋值.html">4. 变量的解构赋值</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. 字符串的扩展</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unicode">5.1. 字符的 Unicode 表示法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#codepointat">5.2. codePointAt()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#string-fromcodepoint">5.3. String.fromCodePoint()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">5.4. 字符串的遍历器接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="#at">5.5. at()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#normalize">5.6. normalize()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#includes-startswith-endswith">5.7. includes(), startsWith(), endsWith()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#repeat">5.8. repeat()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#padstart-padend">5.9. padStart()，padEnd()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#matchall">5.10. matchAll()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">5.11. 模板字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">5.12. 实例：模板编译</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">5.13. 标签模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="#string-raw">5.14. String.raw()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">5.15. 模板字符串的限制</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="正则的扩展.html">6. 正则的扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="数值的扩展.html">7. 数值的扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="函数的扩展.html">8. 函数的扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="数组的扩展.html">9. 数组的扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="对象的扩展.html">10. 对象的扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="Symbol.html">11. Symbol</a></li>
<li class="toctree-l1"><a class="reference internal" href="Set和Map数据结构.html">12. Set和Map数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="Proxy.html">13. Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reflect.html">14. Reflect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Promise对象.html">15. Promise对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="Iterator和for...of循环.html">16. Iterator 和 for…of 循环</a></li>
<li class="toctree-l1"><a class="reference internal" href="Generator函数的语法.html">17. Generator函数的语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="Generator函数的异步应用.html">18. Generator 函数的异步应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="async函数.html">19. asyn函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="Class的基本语法.html">20. Class 的基本语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="Class的继承.html">21. Class的继承</a></li>
<li class="toctree-l1"><a class="reference internal" href="Decorator.html">22. 修饰器</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module的语法.html">23. Module 的语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module的加载实现.html">24. Module 的加载实现</a></li>
<li class="toctree-l1"><a class="reference internal" href="编程风格.html">25. 编程风格</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ECMAScript6入门</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>5. 字符串的扩展</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><a class="toc-backref" href="#id11">5. 字符串的扩展</a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="contents topic" id="id2">
<p class="topic-title first">目录</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id11">字符串的扩展</a><ul>
<li><a class="reference internal" href="#unicode" id="id12">字符的 Unicode 表示法</a></li>
<li><a class="reference internal" href="#codepointat" id="id13">codePointAt()</a></li>
<li><a class="reference internal" href="#string-fromcodepoint" id="id14">String.fromCodePoint()</a></li>
<li><a class="reference internal" href="#id3" id="id15">字符串的遍历器接口</a></li>
<li><a class="reference internal" href="#at" id="id16">at()</a></li>
<li><a class="reference internal" href="#normalize" id="id17">normalize()</a></li>
<li><a class="reference internal" href="#includes-startswith-endswith" id="id18">includes(), startsWith(), endsWith()</a></li>
<li><a class="reference internal" href="#repeat" id="id19">repeat()</a></li>
<li><a class="reference internal" href="#padstart-padend" id="id20">padStart()，padEnd()</a></li>
<li><a class="reference internal" href="#matchall" id="id21">matchAll()</a></li>
<li><a class="reference internal" href="#id5" id="id22">模板字符串</a></li>
<li><a class="reference internal" href="#id6" id="id23">实例：模板编译</a></li>
<li><a class="reference internal" href="#id7" id="id24">标签模板</a></li>
<li><a class="reference internal" href="#string-raw" id="id25">String.raw()</a></li>
<li><a class="reference internal" href="#id10" id="id26">模板字符串的限制</a></li>
</ul>
</li>
</ul>
</div>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 加强了对 <code class="docutils literal"><span class="pre">Unicode</span></code> 的支持，并且扩展了字符串对象。</p>
<div class="section" id="unicode">
<h2><a class="toc-backref" href="#id12">5.1. 字符的 Unicode 表示法</a><a class="headerlink" href="#unicode" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">JavaScript</span></code> 允许采用 <code class="docutils literal"><span class="pre">\uxxxx</span></code> 形式表示一个字符，其中 <code class="docutils literal"><span class="pre">xxxx</span></code> 表示字符的 <code class="docutils literal"><span class="pre">Unicode</span></code> 码点。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;\u0061&quot;</span>
<span class="c1">// &quot;a&quot;</span>
</pre></div>
</div>
<p>但是，这种表示法只限于码点在 <code class="docutils literal"><span class="pre">\u0000~\uFFFF</span></code> 之间的字符。超出这个范围的字符，必须用两个双字节的形式表示。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s2">&quot;\uD842\uDFB7&quot;</span>
<span class="c1">// &quot;𠮷&quot;</span>

<span class="s2">&quot;\u20BB7&quot;</span>
<span class="c1">// &quot; 7&quot;</span>
</pre></div>
</div>
<p>上面代码表示，如果直接在 <code class="docutils literal"><span class="pre">\u</span></code> 后面跟上超过 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的数值（比如 <code class="docutils literal"><span class="pre">\u20BB7</span></code> ）， <code class="docutils literal"><span class="pre">JavaScript</span></code>  会理解成 <code class="docutils literal"><span class="pre">\u20BB+7</span></code> 。由于 <code class="docutils literal"><span class="pre">\u20BB</span></code> 是一个不可打印字符，所以只会显示一个空格，后面跟着一个 <code class="docutils literal"><span class="pre">7</span></code> 。</p>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 对这一点做出了改进，只要将码点放入大括号，就能正确解读该字符。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>&quot;\u{20BB7}&quot;
// &quot;𠮷&quot;

&quot;\u{41}\u{42}\u{43}&quot;
// &quot;ABC&quot;

let hello = 123;
hell\u{6F} // 123

&#39;\u{1F680}&#39; === &#39;\uD83D\uDE80&#39;
// true
</pre></div>
</div>
<p>上面代码中，最后一个例子表明，大括号表示法与四字节的 <code class="docutils literal"><span class="pre">UTF-16</span></code> 编码是等价的。</p>
<p>有了这种表示法之后， <code class="docutils literal"><span class="pre">JavaScript</span></code> 共有 6 种方法可以表示一个字符。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;\z&#39;</span> <span class="o">===</span> <span class="s1">&#39;z&#39;</span>  <span class="c1">// true</span>
<span class="s1">&#39;\172&#39;</span> <span class="o">===</span> <span class="s1">&#39;z&#39;</span> <span class="c1">// true</span>
<span class="s1">&#39;\x7A&#39;</span> <span class="o">===</span> <span class="s1">&#39;z&#39;</span> <span class="c1">// true</span>
<span class="s1">&#39;\u007A&#39;</span> <span class="o">===</span> <span class="s1">&#39;z&#39;</span> <span class="c1">// true</span>
<span class="s1">&#39;\u{7A}&#39;</span> <span class="o">===</span> <span class="s1">&#39;z&#39;</span> <span class="c1">// true</span>
</pre></div>
</div>
</div>
<div class="section" id="codepointat">
<h2><a class="toc-backref" href="#id13">5.2. codePointAt()</a><a class="headerlink" href="#codepointat" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">JavaScript</span></code> 内部，字符以 <code class="docutils literal"><span class="pre">UTF-16</span></code> 的格式储存，每个字符固定为2个字节。对于那些需要4个字节储存的字符（Unicode 码点大于 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的字符）， <code class="docutils literal"><span class="pre">JavaScript</span></code> 会认为它们是两个字符。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="s2">&quot;𠮷&quot;</span><span class="p">;</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 2</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// &#39;&#39;</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// &#39;&#39;</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// 55362</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// 57271</span>
</pre></div>
</div>
<p>上面代码中，汉字“𠮷”（注意，这个字不是“吉祥”的“吉”）的码点是 <code class="docutils literal"><span class="pre">0x20BB7</span></code> ， <code class="docutils literal"><span class="pre">UTF-16</span></code> 编码为 <code class="docutils literal"><span class="pre">0xD842</span> <span class="pre">0xDFB7</span></code> （十进制为 <code class="docutils literal"><span class="pre">55362</span> <span class="pre">57271</span></code> ），需要4个字节储存。对于这种4个字节的字符， <code class="docutils literal"><span class="pre">JavaScript</span></code> 不能正确处理，字符串长度会误判为2，而且 <code class="docutils literal"><span class="pre">charAt</span></code> 方法无法读取整个字符， <code class="docutils literal"><span class="pre">charCodeAt</span></code> 方法只能分别返回前两个字节和后两个字节的值。</p>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 提供了 <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法，能够正确处理 4 个字节储存的字符，返回一个字符的码点。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;𠮷a&#39;</span><span class="p">;</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// 134071</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// 57271</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 97</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">codePointAt</span></code> 方法的参数，是字符在字符串中的位置（从 0 开始）。上面代码中， <code class="docutils literal"><span class="pre">JavaScript</span></code> 将“𠮷a”视为三个字符， <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法在第一个字符上，正确地识别了“𠮷”，返回了它的十进制码点 <code class="docutils literal"><span class="pre">134071``（即十六进制的20BB7）。在第二个字符（即“𠮷”的后两个字节）和第三个字符“a”上，</span> <span class="pre">``codePointAt</span></code> 方法的结果与 <code class="docutils literal"><span class="pre">charCodeAt</span></code> 方法相同。</p>
<p>总之， <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法会正确返回 32 位的 UTF-16 字符的码点。对于那些两个字节储存的常规字符，它的返回结果与 <code class="docutils literal"><span class="pre">charCodeAt</span></code> 方法相同。</p>
<p><code class="docutils literal"><span class="pre">codePointAt</span></code> 方法返回的是码点的十进制值，如果想要十六进制的值，可以使用 <code class="docutils literal"><span class="pre">toString</span></code> 方法转换一下。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;𠮷a&#39;</span><span class="p">;</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="c1">// &quot;20bb7&quot;</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="c1">// &quot;61&quot;</span>
</pre></div>
</div>
<p>你可能注意到了， <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法的参数，仍然是不正确的。比如，上面代码中，字符a在字符串s的正确位置序号应该是 1，但是必须向 <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法传入 2。解决这个问题的一个办法是使用 <code class="docutils literal"><span class="pre">for...of</span></code> 循环，因为它会正确识别 32 位的 UTF-16 字符。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;𠮷a&#39;</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">ch</span> <span class="k">of</span> <span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ch</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
<span class="p">}</span>
<span class="c1">// 20bb7</span>
<span class="c1">// 61</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">codePointAt</span></code> 方法是测试一个字符由两个字节还是由四个字节组成的最简单方法。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">is32Bit</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">codePointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">is32Bit</span><span class="p">(</span><span class="s2">&quot;𠮷&quot;</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">is32Bit</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="c1">// false</span>
</pre></div>
</div>
</div>
<div class="section" id="string-fromcodepoint">
<h2><a class="toc-backref" href="#id14">5.3. String.fromCodePoint()</a><a class="headerlink" href="#string-fromcodepoint" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ES5</span></code> 提供 <code class="docutils literal"><span class="pre">String.fromCharCode</span></code> 方法，用于从码点返回对应字符，但是这个方法不能识别 32 位的 UTF-16 字符（Unicode 编号大于0xFFFF）。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mh">0x20BB7</span><span class="p">)</span>
<span class="c1">// &quot;ஷ&quot;</span>
</pre></div>
</div>
<p>上面代码中， <code class="docutils literal"><span class="pre">String.fromCharCode</span></code> 不能识别大于 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的码点，所以 <code class="docutils literal"><span class="pre">0x20BB7</span></code> 就发生了溢出，最高位2被舍弃了，最后返回码点 <code class="docutils literal"><span class="pre">U+0BB7</span></code> 对应的字符，而不是码点 <code class="docutils literal"><span class="pre">U+20BB7</span></code> 对应的字符。</p>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 提供了 <code class="docutils literal"><span class="pre">String.fromCodePoint</span></code> 方法，可以识别大于 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的字符，弥补了 <code class="docutils literal"><span class="pre">String.fromCharCode</span></code> 方法的不足。在作用上，正好与 <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法相反。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCodePoint</span><span class="p">(</span><span class="mh">0x20BB7</span><span class="p">)</span>
<span class="c1">// &quot;𠮷&quot;</span>
<span class="nb">String</span><span class="p">.</span><span class="nx">fromCodePoint</span><span class="p">(</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x1f680</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;x\uD83D\uDE80y&#39;</span>
<span class="c1">// true</span>
</pre></div>
</div>
<p>上面代码中，如果 <code class="docutils literal"><span class="pre">String.fromCodePoint</span></code> 方法有多个参数，则它们会被合并成一个字符串返回。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><code class="docutils literal"><span class="pre">fromCodePoint</span></code> 方法定义在 <code class="docutils literal"><span class="pre">String</span></code> 对象上，而 <code class="docutils literal"><span class="pre">codePointAt</span></code> 方法定义在字符串的实例对象上。</p>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id15">5.4. 字符串的遍历器接口</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 为字符串添加了遍历器接口（详见《Iterator》一章），使得字符串可以被 <code class="docutils literal"><span class="pre">for...of</span></code> 循环遍历。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">codePoint</span> <span class="k">of</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">codePoint</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// &quot;f&quot;</span>
<span class="c1">// &quot;o&quot;</span>
<span class="c1">// &quot;o&quot;</span>
</pre></div>
</div>
<p>除了遍历字符串，这个遍历器最大的优点是可以识别大于 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的码点，传统的 <code class="docutils literal"><span class="pre">for</span></code> 循环无法识别这样的码点。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">text</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCodePoint</span><span class="p">(</span><span class="mh">0x20BB7</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>
<span class="c1">// &quot; &quot;</span>
<span class="c1">// &quot; &quot;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// &quot;𠮷&quot;</span>
</pre></div>
</div>
<p>上面代码中，字符串 <code class="docutils literal"><span class="pre">text</span></code> 只有一个字符，但是 <code class="docutils literal"><span class="pre">for</span></code> 循环会认为它包含两个字符（都不可打印），而 <code class="docutils literal"><span class="pre">for...of</span></code> 循环会正确识别出这一个字符。</p>
</div>
<div class="section" id="at">
<h2><a class="toc-backref" href="#id16">5.5. at()</a><a class="headerlink" href="#at" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ES5</span></code> 对字符串对象提供 <code class="docutils literal"><span class="pre">charAt</span></code> 方法，返回字符串给定位置的字符。该方法不能识别码点大于 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的字符。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// &quot;a&quot;</span>
<span class="s1">&#39;𠮷&#39;</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// &quot;\uD842&quot;</span>
</pre></div>
</div>
<p>上面代码中的第二条语句， <code class="docutils literal"><span class="pre">charAt</span></code> 方法期望返回的是用2个字节表示的字符，但汉字“𠮷”占用了4个字节， <code class="docutils literal"><span class="pre">charAt(0)</span></code> 表示获取这4个字节中的前2个字节，很显然，这是无法正常显示的。</p>
<p>目前，有一个提案，提出字符串实例的 <code class="docutils literal"><span class="pre">at</span></code> 方法，可以识别 <code class="docutils literal"><span class="pre">Unicode</span></code>  编号大于 <code class="docutils literal"><span class="pre">0xFFFF</span></code> 的字符，返回正确的字符。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// &quot;a&quot;</span>
<span class="s1">&#39;𠮷&#39;</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// &quot;𠮷&quot;</span>
</pre></div>
</div>
<p>这个方法可以通过 <a class="reference external" href="https://github.com/es-shims/String.prototype.at">垫片库</a> 实现。</p>
</div>
<div class="section" id="normalize">
<h2><a class="toc-backref" href="#id17">5.6. normalize()</a><a class="headerlink" href="#normalize" title="永久链接至标题">¶</a></h2>
<p>许多欧洲语言有语调符号和重音符号。为了表示它们， <code class="docutils literal"><span class="pre">Unicode</span></code> 提供了两种方法。一种是直接提供带重音符号的字符，比如Ǒ（ <code class="docutils literal"><span class="pre">\u01D1</span></code> ）。另一种是提供合成符号（combining character），即原字符与重音符号的合成，两个字符合成一个字符，比如O（ <code class="docutils literal"><span class="pre">\u004F</span></code> ）和ˇ（ <code class="docutils literal"><span class="pre">\u030C</span></code> ）合成Ǒ（ <code class="docutils literal"><span class="pre">\u004F\u030C</span></code> ）。</p>
<p>这两种表示方法，在视觉和语义上都等价，但是 <code class="docutils literal"><span class="pre">JavaScript</span></code> 不能识别。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;\u01D1&#39;</span><span class="o">===</span><span class="s1">&#39;\u004F\u030C&#39;</span> <span class="c1">//false</span>

<span class="s1">&#39;\u01D1&#39;</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 1</span>
<span class="s1">&#39;\u004F\u030C&#39;</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 2</span>
</pre></div>
</div>
<p>上面代码表示， <code class="docutils literal"><span class="pre">JavaScript</span></code> 将合成字符视为两个字符，导致两种表示方法不相等。</p>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 提供字符串实例的 <code class="docutils literal"><span class="pre">normalize()</span></code> 方法，用来将字符的不同表示方法统一为同样的形式，这称为 <code class="docutils literal"><span class="pre">Unicode</span></code> 正规化。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;\u01D1&#39;</span><span class="p">.</span><span class="nx">normalize</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;\u004F\u030C&#39;</span><span class="p">.</span><span class="nx">normalize</span><span class="p">()</span>
<span class="c1">// true</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">normalize</span></code> 方法可以接受一个参数来指定 <code class="docutils literal"><span class="pre">normalize</span></code> 的方式，参数的四个可选值如下。</p>
<ul class="simple">
<li>NFC，默认参数，表示“标准等价合成”（Normalization Form Canonical Composition），返回多个简单字符的合成字符。所谓“标准等价”指的是视觉和语义上的等价。</li>
<li>NFD，表示“标准等价分解”（Normalization Form Canonical Decomposition），即在标准等价的前提下，返回合成字符分解的多个简单字符。</li>
<li>NFKC，表示“兼容等价合成”（Normalization Form Compatibility Composition），返回合成字符。所谓“兼容等价”指的是语义上存在等价，但视觉上不等价，比如“囍”和“喜喜”。（这只是用来举例，normalize方法不能识别中文。）</li>
<li>NFKD，表示“兼容等价分解”（Normalization Form Compatibility Decomposition），即在兼容等价的前提下，返回合成字符分解的多个简单字符。</li>
</ul>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;\u004F\u030C&#39;</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="s1">&#39;NFC&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="c1">// 1</span>
<span class="s1">&#39;\u004F\u030C&#39;</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="s1">&#39;NFD&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="c1">// 2</span>
</pre></div>
</div>
<p>上面代码表示， <code class="docutils literal"><span class="pre">NFC</span></code> 参数返回字符的合成形式， <code class="docutils literal"><span class="pre">NFD</span></code> 参数返回字符的分解形式。</p>
<p>不过， <code class="docutils literal"><span class="pre">normalize</span></code> 方法目前不能识别三个或三个以上字符的合成。这种情况下，还是只能使用正则表达式，通过 <code class="docutils literal"><span class="pre">Unicode</span></code> 编号区间判断。</p>
</div>
<div class="section" id="includes-startswith-endswith">
<h2><a class="toc-backref" href="#id18">5.7. includes(), startsWith(), endsWith()</a><a class="headerlink" href="#includes-startswith-endswith" title="永久链接至标题">¶</a></h2>
<p>传统上， <code class="docutils literal"><span class="pre">JavaScript</span></code> 只有 <code class="docutils literal"><span class="pre">indexOf</span></code> 方法，可以用来确定一个字符串是否包含在另一个字符串中。 <code class="docutils literal"><span class="pre">ES6</span></code> 又提供了三种新方法。</p>
<ul class="simple">
<li>includes()：返回布尔值，表示是否找到了参数字符串。</li>
<li>startsWith()：返回布尔值，表示参数字符串是否在原字符串的头部。</li>
<li>endsWith()：返回布尔值，表示参数字符串是否在原字符串的尾部。</li>
</ul>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;Hello world!&#39;</span><span class="p">;</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)</span> <span class="c1">// true</span>
</pre></div>
</div>
<p>这三个方法都支持第二个参数，表示开始搜索的位置。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;Hello world!&#39;</span><span class="p">;</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// true</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">// false</span>
</pre></div>
</div>
<p>上面代码表示，使用第二个参数 <code class="docutils literal"><span class="pre">n</span></code> 时， <code class="docutils literal"><span class="pre">endsWith</span></code> 的行为与其他两个方法有所不同。它针对前 <code class="docutils literal"><span class="pre">n</span></code> 个字符，而其他两个方法针对从第 <code class="docutils literal"><span class="pre">n</span></code> 个位置直到字符串结束。</p>
</div>
<div class="section" id="repeat">
<h2><a class="toc-backref" href="#id19">5.8. repeat()</a><a class="headerlink" href="#repeat" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">repeat</span></code> 方法返回一个新字符串，表示将原字符串重复 <code class="docutils literal"><span class="pre">n</span></code> 次。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// &quot;xxx&quot;</span>
<span class="s1">&#39;hello&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// &quot;hellohello&quot;</span>
<span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// &quot;&quot;</span>
</pre></div>
</div>
<p>参数如果是小数，会被取整。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="mf">2.9</span><span class="p">)</span> <span class="c1">// &quot;nana&quot;</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal"><span class="pre">repeat</span></code> 的参数是负数或者 <code class="docutils literal"><span class="pre">Infinity</span></code> ，会报错。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="kc">Infinity</span><span class="p">)</span>
<span class="c1">// RangeError</span>
<span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">// RangeError</span>
</pre></div>
</div>
<p>但是，如果参数是 <code class="docutils literal"><span class="pre">0</span></code> 到 <code class="docutils literal"><span class="pre">-1</span></code> 之间的小数，则等同于 <code class="docutils literal"><span class="pre">0</span></code> ，这是因为会先进行取整运算。 <code class="docutils literal"><span class="pre">0</span></code> 到 <code class="docutils literal"><span class="pre">-1</span></code> 之间的小数，取整以后等于 <code class="docutils literal"><span class="pre">-0</span></code> ， <code class="docutils literal"><span class="pre">repeat</span></code> 视同为 <code class="docutils literal"><span class="pre">0</span></code> 。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">)</span> <span class="c1">// &quot;&quot;</span>
</pre></div>
</div>
<p>参数 <code class="docutils literal"><span class="pre">NaN</span></code> 等同于 <code class="docutils literal"><span class="pre">0</span></code> 。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="kc">NaN</span><span class="p">)</span> <span class="c1">// &quot;&quot;</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal"><span class="pre">repeat</span></code> 的参数是字符串，则会先转换成数字。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">&#39;na&#39;</span><span class="p">)</span> <span class="c1">// &quot;&quot;</span>
<span class="s1">&#39;na&#39;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">)</span> <span class="c1">// &quot;nanana&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="padstart-padend">
<h2><a class="toc-backref" href="#id20">5.9. padStart()，padEnd()</a><a class="headerlink" href="#padstart-padend" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ES2017</span></code> 引入了字符串补全长度的功能。如果某个字符串不够指定长度，会在头部或尾部补全。 <code class="docutils literal"><span class="pre">padStart()</span></code> 用于头部补全， <code class="docutils literal"><span class="pre">padEnd()</span></code> 用于尾部补全。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1">// &#39;ababx&#39;</span>
<span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1">// &#39;abax&#39;</span>

<span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1">// &#39;xabab&#39;</span>
<span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1">// &#39;xaba&#39;</span>
</pre></div>
</div>
<p>上面代码中， <code class="docutils literal"><span class="pre">padStart</span></code> 和 <code class="docutils literal"><span class="pre">padEnd</span></code> 一共接受两个参数，第一个参数用来指定字符串的最小长度，第二个参数是用来补全的字符串。</p>
<p>如果原字符串的长度，等于或大于指定的最小长度，则返回原字符串。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;xxx&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1">// &#39;xxx&#39;</span>
<span class="s1">&#39;xxx&#39;</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1">// &#39;xxx&#39;</span>
</pre></div>
</div>
<p>如果用来补全的字符串与原字符串，两者的长度之和超过了指定的最小长度，则会截去超出位数的补全字符串。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span>
<span class="c1">// &#39;0123456abc&#39;</span>
</pre></div>
</div>
<p>如果省略第二个参数，默认使用空格补全长度。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// &#39;   x&#39;</span>
<span class="s1">&#39;x&#39;</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// &#39;x   &#39;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">padStart</span></code> 的常见用途是为数值补全指定位数。下面代码生成 10 位的数值字符串。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;1&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="c1">// &quot;0000000001&quot;</span>
<span class="s1">&#39;12&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="c1">// &quot;0000000012&quot;</span>
<span class="s1">&#39;123456&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="c1">// &quot;0000123456&quot;</span>
</pre></div>
</div>
<p>另一个用途是提示字符串格式。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="s1">&#39;12&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span> <span class="c1">// &quot;YYYY-MM-12&quot;</span>
<span class="s1">&#39;09-12&#39;</span><span class="p">.</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span> <span class="c1">// &quot;YYYY-09-12&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="matchall">
<h2><a class="toc-backref" href="#id21">5.10. matchAll()</a><a class="headerlink" href="#matchall" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">matchAll</span></code> 方法返回一个正则表达式在当前字符串的所有匹配，详见《正则的扩展》的一章。</p>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id22">5.11. 模板字符串</a><a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>传统的 <code class="docutils literal"><span class="pre">JavaScript</span></code> 语言，输出模板通常是这样写的。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#result&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span>
  <span class="s1">&#39;There are &lt;b&gt;&#39;</span> <span class="o">+</span> <span class="nx">basket</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="s1">&#39;&lt;/b&gt; &#39;</span> <span class="o">+</span>
  <span class="s1">&#39;items in your basket, &#39;</span> <span class="o">+</span>
  <span class="s1">&#39;&lt;em&gt;&#39;</span> <span class="o">+</span> <span class="nx">basket</span><span class="p">.</span><span class="nx">onSale</span> <span class="o">+</span>
  <span class="s1">&#39;&lt;/em&gt; are on sale!&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>上面这种写法相当繁琐不方便， <code class="docutils literal"><span class="pre">ES6</span></code> 引入了模板字符串解决这个问题。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>// 普通字符串
`In JavaScript &#39;\n&#39; is a line-feed.`

// 多行字符串
`In JavaScript this is
 not legal.`

console.log(`string text line 1
string text line 2`);

// 字符串中嵌入变量
let name = &quot;Bob&quot;, time = &quot;today&quot;;
let result  = `Hello ${name}, how are you ${time}?`;
console.log(result);
</pre></div>
</div>
<p>上面代码中的模板字符串，都是用反引号表示。如果在模板字符串中需要使用反引号，则前面要用反斜杠转义。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="sb">`\`Yo\` World!`</span><span class="p">;</span>
</pre></div>
</div>
<p>如果使用模板字符串表示多行字符串，所有的空格和缩进都会被保留在输出之中。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#list&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">&lt;ul&gt;</span>
<span class="sb">  &lt;li&gt;first&lt;/li&gt;</span>
<span class="sb">  &lt;li&gt;second&lt;/li&gt;</span>
<span class="sb">&lt;/ul&gt;</span>
<span class="sb">`</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，所有模板字符串的空格和换行，都是被保留的，比如 <code class="docutils literal"><span class="pre">&lt;ul&gt;</span></code> 标签前面会有一个换行。如果你不想要这个换行，可以使用 <code class="docutils literal"><span class="pre">trim</span></code> 方法消除它。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#list&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">&lt;ul&gt;</span>
<span class="sb">  &lt;li&gt;first&lt;/li&gt;</span>
<span class="sb">  &lt;li&gt;second&lt;/li&gt;</span>
<span class="sb">&lt;/ul&gt;</span>
<span class="sb">`</span><span class="p">.</span><span class="nx">trim</span><span class="p">());</span>
</pre></div>
</div>
<p>模板字符串中嵌入变量，需要将变量名写在 <code class="docutils literal"><span class="pre">${}</span></code> 之中。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">authorize</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">hasPrivilege</span><span class="p">(</span><span class="nx">action</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
      <span class="c1">// 传统写法为</span>
      <span class="c1">// &#39;User &#39;</span>
      <span class="c1">// + user.name</span>
      <span class="c1">// + &#39; is not authorized to do &#39;</span>
      <span class="c1">// + action</span>
      <span class="c1">// + &#39;.&#39;</span>
      <span class="sb">`User </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> is not authorized to do </span><span class="si">${</span><span class="nx">action</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>大括号内部可以放入任意的 <code class="docutils literal"><span class="pre">JavaScript</span></code> 表达式，可以进行运算，以及引用对象属性。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="sb">`</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb"> + </span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="si">}</span><span class="sb">`</span>
<span class="c1">// &quot;1 + 2 = 3&quot;</span>

<span class="sb">`</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb"> + </span><span class="si">${</span><span class="nx">y</span> <span class="o">*</span> <span class="mi">2</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="mi">2</span><span class="si">}</span><span class="sb">`</span>
<span class="c1">// &quot;1 + 4 = 5&quot;</span>

<span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span><span class="p">};</span>
<span class="sb">`</span><span class="si">${</span><span class="nx">obj</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span>
<span class="c1">// &quot;3&quot;</span>
</pre></div>
</div>
<p>模板字符串之中还能调用函数。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="sb">`foo </span><span class="si">${</span><span class="nx">fn</span><span class="p">()</span><span class="si">}</span><span class="sb"> bar`</span>
<span class="c1">// foo Hello World bar</span>
</pre></div>
</div>
<p>如果大括号中的值不是字符串，将按照一般的规则转为字符串。比如，大括号中是一个对象，将默认调用对象的 <code class="docutils literal"><span class="pre">toString</span></code> 方法。</p>
<p>如果模板字符串中的变量没有声明，将报错。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="c1">// 变量place没有声明</span>
<span class="kd">let</span> <span class="nx">msg</span> <span class="o">=</span> <span class="sb">`Hello, </span><span class="si">${</span><span class="nx">place</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="c1">// 报错</span>
</pre></div>
</div>
<p>由于模板字符串的大括号内部，就是执行 <code class="docutils literal"><span class="pre">JavaScript</span></code> 代码，因此如果大括号内部是一个字符串，将会原样输出。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="sb">`Hello </span><span class="si">${</span><span class="s1">&#39;World&#39;</span><span class="si">}</span><span class="sb">`</span>
<span class="c1">// &quot;Hello World&quot;</span>
</pre></div>
</div>
<p>模板字符串甚至还能嵌套。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">tmpl</span> <span class="o">=</span> <span class="nx">addrs</span> <span class="p">=&gt;</span> <span class="sb">`</span>
<span class="sb">  &lt;table&gt;</span>
<span class="sb">  </span><span class="si">${</span><span class="nx">addrs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">addr</span> <span class="p">=&gt;</span> <span class="sb">`</span>
<span class="sb">    &lt;tr&gt;&lt;td&gt;</span><span class="si">${</span><span class="nx">addr</span><span class="p">.</span><span class="nx">first</span><span class="si">}</span><span class="sb">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sb">    &lt;tr&gt;&lt;td&gt;</span><span class="si">${</span><span class="nx">addr</span><span class="p">.</span><span class="nx">last</span><span class="si">}</span><span class="sb">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sb">  `</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb"></span>
<span class="sb">  &lt;/table&gt;</span>
<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
<p>上面代码中，模板字符串的变量之中，又嵌入了另一个模板字符串，使用方法如下。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">first</span><span class="o">:</span> <span class="s1">&#39;&lt;Jane&gt;&#39;</span><span class="p">,</span> <span class="nx">last</span><span class="o">:</span> <span class="s1">&#39;Bond&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">first</span><span class="o">:</span> <span class="s1">&#39;Lars&#39;</span><span class="p">,</span> <span class="nx">last</span><span class="o">:</span> <span class="s1">&#39;&lt;Croft&gt;&#39;</span> <span class="p">},</span>
<span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">tmpl</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="c1">// &lt;table&gt;</span>
<span class="c1">//</span>
<span class="c1">//   &lt;tr&gt;&lt;td&gt;&lt;Jane&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="c1">//   &lt;tr&gt;&lt;td&gt;Bond&lt;/td&gt;&lt;/tr&gt;</span>
<span class="c1">//</span>
<span class="c1">//   &lt;tr&gt;&lt;td&gt;Lars&lt;/td&gt;&lt;/tr&gt;</span>
<span class="c1">//   &lt;tr&gt;&lt;td&gt;&lt;Croft&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="c1">//</span>
<span class="c1">// &lt;/table&gt;</span>
</pre></div>
</div>
<p>如果需要引用模板字符串本身，在需要时执行，可以像下面这样写。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="c1">// 写法一</span>
<span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;return &#39;</span> <span class="o">+</span> <span class="s1">&#39;`Hello ${name}!`&#39;</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">func</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">str</span><span class="p">);</span>
<span class="nx">func</span><span class="p">(</span><span class="s1">&#39;Jack&#39;</span><span class="p">)</span> <span class="c1">// &quot;Hello Jack!&quot;</span>

<span class="c1">// 写法二</span>
<span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;(name) =&gt; `Hello ${name}!`&#39;</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">str</span><span class="p">);</span>
<span class="nx">func</span><span class="p">(</span><span class="s1">&#39;Jack&#39;</span><span class="p">)</span> <span class="c1">// &quot;Hello Jack!&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id23">5.12. 实例：模板编译</a><a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>下面，我们来看一个通过模板字符串，生成正式模板的实例。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">template</span> <span class="o">=</span> <span class="sb">`</span>
<span class="sb">&lt;ul&gt;</span>
<span class="sb">  &lt;% for(let i=0; i &lt; data.supplies.length; i++) { %&gt;</span>
<span class="sb">    &lt;li&gt;&lt;%= data.supplies[i] %&gt;&lt;/li&gt;</span>
<span class="sb">  &lt;% } %&gt;</span>
<span class="sb">&lt;/ul&gt;</span>
<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
<p>上面代码在模板字符串之中，放置了一个常规模板。该模板使用 <code class="docutils literal"><span class="pre">&lt;%...%&gt;</span></code> 放置 <code class="docutils literal"><span class="pre">JavaScript</span></code> 代码，使用 <code class="docutils literal"><span class="pre">&lt;%=</span> <span class="pre">...</span> <span class="pre">%&gt;</span></code> 输出 <code class="docutils literal"><span class="pre">JavaScript</span></code> 表达式。</p>
<p>怎么编译这个模板字符串呢？</p>
<p>一种思路是将其转换为 <code class="docutils literal"><span class="pre">JavaScript</span></code> 表达式字符串。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">echo</span><span class="p">(</span><span class="s1">&#39;&lt;ul&gt;&#39;</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">supplies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">echo</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&#39;</span><span class="p">);</span>
  <span class="nx">echo</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">supplies</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="nx">echo</span><span class="p">(</span><span class="s1">&#39;&lt;/li&gt;&#39;</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">echo</span><span class="p">(</span><span class="s1">&#39;&lt;/ul&gt;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>这个转换使用正则表达式就行了。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">evalExpr</span> <span class="o">=</span> <span class="sr">/&lt;%=(.+?)%&gt;/g</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">expr</span> <span class="o">=</span> <span class="sr">/&lt;%([\s\S]+?)%&gt;/g</span><span class="p">;</span>

<span class="nx">template</span> <span class="o">=</span> <span class="nx">template</span>
  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">evalExpr</span><span class="p">,</span> <span class="s1">&#39;`); \n  echo( $1 ); \n  echo(`&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="s1">&#39;`); \n $1 \n  echo(`&#39;</span><span class="p">);</span>

<span class="nx">template</span> <span class="o">=</span> <span class="s1">&#39;echo(`&#39;</span> <span class="o">+</span> <span class="nx">template</span> <span class="o">+</span> <span class="s1">&#39;`);&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>然后，将 <code class="docutils literal"><span class="pre">template</span></code> 封装在一个函数里面返回，就可以了。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span>
<span class="sb">`(function parse(data){</span>
<span class="sb">  let output = &quot;&quot;;</span>

<span class="sb">  function echo(html){</span>
<span class="sb">    output += html;</span>
<span class="sb">  }</span>

<span class="sb">  </span><span class="si">${</span> <span class="nx">template</span> <span class="si">}</span><span class="sb"></span>

<span class="sb">  return output;</span>
<span class="sb">})`</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">script</span><span class="p">;</span>
</pre></div>
</div>
<p>将上面的内容拼装成一个模板编译函数 <code class="docutils literal"><span class="pre">compile</span></code> 。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">compile</span><span class="p">(</span><span class="nx">template</span><span class="p">){</span>
  <span class="kr">const</span> <span class="nx">evalExpr</span> <span class="o">=</span> <span class="sr">/&lt;%=(.+?)%&gt;/g</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">expr</span> <span class="o">=</span> <span class="sr">/&lt;%([\s\S]+?)%&gt;/g</span><span class="p">;</span>

  <span class="nx">template</span> <span class="o">=</span> <span class="nx">template</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">evalExpr</span><span class="p">,</span> <span class="s1">&#39;`); \n  echo( $1 ); \n  echo(`&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="s1">&#39;`); \n $1 \n  echo(`&#39;</span><span class="p">);</span>

  <span class="nx">template</span> <span class="o">=</span> <span class="s1">&#39;echo(`&#39;</span> <span class="o">+</span> <span class="nx">template</span> <span class="o">+</span> <span class="s1">&#39;`);&#39;</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span>
  <span class="sb">`(function parse(data){</span>
<span class="sb">    let output = &quot;&quot;;</span>

<span class="sb">    function echo(html){</span>
<span class="sb">      output += html;</span>
<span class="sb">    }</span>

<span class="sb">    </span><span class="si">${</span> <span class="nx">template</span> <span class="si">}</span><span class="sb"></span>

<span class="sb">    return output;</span>
<span class="sb">  })`</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">script</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">compile</span></code> 函数的用法如下。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">parse</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">compile</span><span class="p">(</span><span class="nx">template</span><span class="p">));</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">parse</span><span class="p">({</span> <span class="nx">supplies</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;broom&quot;</span><span class="p">,</span> <span class="s2">&quot;mop&quot;</span><span class="p">,</span> <span class="s2">&quot;cleaner&quot;</span> <span class="p">]</span> <span class="p">});</span>
<span class="c1">//   &lt;ul&gt;</span>
<span class="c1">//     &lt;li&gt;broom&lt;/li&gt;</span>
<span class="c1">//     &lt;li&gt;mop&lt;/li&gt;</span>
<span class="c1">//     &lt;li&gt;cleaner&lt;/li&gt;</span>
<span class="c1">//   &lt;/ul&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id24">5.13. 标签模板</a><a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>模板字符串的功能，不仅仅是上面这些。它可以紧跟在一个函数名后面，该函数将被调用来处理这个模板字符串。这被称为“标签模板”功能（tagged template）。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">alert</span><span class="sb">`123`</span>
<span class="c1">// 等同于</span>
<span class="nx">alert</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
<p>标签模板其实不是模板，而是函数调用的一种特殊形式。“标签”指的就是函数，紧跟在后面的模板字符串就是它的参数。</p>
<p>但是，如果模板字符里面有变量，就不是简单的调用了，而是会将模板字符串先处理成多个参数，再调用函数。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="nx">tag</span><span class="sb">`Hello </span><span class="si">${</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="si">}</span><span class="sb"> world </span><span class="si">${</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">b</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="c1">// 等同于</span>
<span class="nx">tag</span><span class="p">([</span><span class="s1">&#39;Hello &#39;</span><span class="p">,</span> <span class="s1">&#39; world &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
<p>上面代码中，模板字符串前面有一个标识名 <code class="docutils literal"><span class="pre">tag</span></code> ，它是一个函数。整个表达式的返回值，就是 <code class="docutils literal"><span class="pre">tag</span></code> 函数处理模板字符串后的返回值。</p>
<p>函数 <code class="docutils literal"><span class="pre">tag</span></code> 依次会接收到多个参数。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">tag</span><span class="p">(</span><span class="nx">stringArr</span><span class="p">,</span> <span class="nx">value1</span><span class="p">,</span> <span class="nx">value2</span><span class="p">){</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// 等同于</span>

<span class="kd">function</span> <span class="nx">tag</span><span class="p">(</span><span class="nx">stringArr</span><span class="p">,</span> <span class="p">...</span><span class="nx">values</span><span class="p">){</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a href="#id8"><span class="problematic" id="id9">``</span></a>tag``f函数的第一个参数是一个数组，该数组的成员是模板字符串中那些没有变量替换的部分，也就是说，变量替换只发生在数组的第一个成员与第二个成员之间、第二个成员与第三个成员之间，以此类推。</p>
<p><code class="docutils literal"><span class="pre">tag``f函数的其他参数，都是模板字符串各个变量被替换后的值。由于本例中，模板字符串含有两个变量，因此</span> <span class="pre">``tag</span></code> 会接受到 <code class="docutils literal"><span class="pre">value1</span></code> 和 <code class="docutils literal"><span class="pre">value2</span></code> 两个参数。</p>
<p><code class="docutils literal"><span class="pre">tag</span></code> 函数所有参数的实际值如下。</p>
<ul class="simple">
<li>第一个参数：[‘Hello ‘, ‘ world ‘, ‘’]</li>
<li>第二个参数: 15</li>
<li>第三个参数：50</li>
</ul>
<p>也就是说， <code class="docutils literal"><span class="pre">tag</span></code> 函数实际上以下面的形式调用。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">tag</span><span class="p">([</span><span class="s1">&#39;Hello &#39;</span><span class="p">,</span> <span class="s1">&#39; world &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>我们可以按照需要编写 <code class="docutils literal"><span class="pre">tag</span></code> 函数的代码。下面是 <code class="docutils literal"><span class="pre">tag</span></code> 函数的一种写法，以及运行结果。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">tag</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v1</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v2</span><span class="p">);</span>

  <span class="k">return</span> <span class="s2">&quot;OK&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">tag</span><span class="sb">`Hello </span><span class="si">${</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="si">}</span><span class="sb"> world </span><span class="si">${</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">b</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="c1">// &quot;Hello &quot;</span>
<span class="c1">// &quot; world &quot;</span>
<span class="c1">// &quot;&quot;</span>
<span class="c1">// 15</span>
<span class="c1">// 50</span>
<span class="c1">// &quot;OK&quot;</span>
</pre></div>
</div>
<p>下面是一个更复杂的例子。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">passthru</span><span class="sb">`The total is </span><span class="si">${</span><span class="nx">total</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">total</span><span class="o">*</span><span class="mf">1.05</span><span class="si">}</span><span class="sb"> with tax)`</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">passthru</span><span class="p">(</span><span class="nx">literals</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">literals</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">+=</span> <span class="nx">literals</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">+=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">msg</span> <span class="c1">// &quot;The total is 30 (31.5 with tax)&quot;</span>
</pre></div>
</div>
<p>上面这个例子展示了，如何将各个参数按照原来的位置拼合回去。</p>
<p><code class="docutils literal"><span class="pre">passthru</span></code> 函数采用 <code class="docutils literal"><span class="pre">rest</span></code> 参数的写法如下。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">passthru</span><span class="p">(</span><span class="nx">literals</span><span class="p">,</span> <span class="p">...</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">index</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">literals</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="nx">output</span> <span class="o">+=</span> <span class="nx">literals</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>“标签模板”的一个重要应用，就是过滤 <code class="docutils literal"><span class="pre">HTML</span></code> 字符串，防止用户输入恶意内容。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">message</span> <span class="o">=</span>
  <span class="nx">SaferHTML</span><span class="sb">`&lt;p&gt;</span><span class="si">${</span><span class="nx">sender</span><span class="si">}</span><span class="sb"> has sent you a message.&lt;/p&gt;`</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">SaferHTML</span><span class="p">(</span><span class="nx">templateData</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">templateData</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">arg</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

    <span class="c1">// Escape special characters in the substitution.</span>
    <span class="nx">s</span> <span class="o">+=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;/g</span><span class="p">,</span> <span class="s2">&quot;&amp;amp;&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span> <span class="s2">&quot;&amp;lt;&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&amp;gt;&quot;</span><span class="p">);</span>

    <span class="c1">// Don&#39;t escape special characters in the template.</span>
    <span class="nx">s</span> <span class="o">+=</span> <span class="nx">templateData</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面代码中， <code class="docutils literal"><span class="pre">sender</span></code> 变量往往是用户提供的，经过 <code class="docutils literal"><span class="pre">SaferHTML</span></code> 函数处理，里面的特殊字符都会被转义。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">sender</span> <span class="o">=</span> <span class="s1">&#39;&lt;script&gt;alert(&quot;abc&quot;)&lt;/script&gt;&#39;</span><span class="p">;</span> <span class="c1">// 恶意代码</span>
<span class="kd">let</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">SaferHTML</span><span class="sb">`&lt;p&gt;</span><span class="si">${</span><span class="nx">sender</span><span class="si">}</span><span class="sb"> has sent you a message.&lt;/p&gt;`</span><span class="p">;</span>

<span class="nx">message</span>
<span class="c1">// &lt;p&gt;&amp;lt;script&amp;gt;alert(&quot;abc&quot;)&amp;lt;/script&amp;gt; has sent you a message.&lt;/p&gt;</span>
</pre></div>
</div>
<p>标签模板的另一个应用，就是多语言转换（国际化处理）。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">i18n</span><span class="sb">`Welcome to </span><span class="si">${</span><span class="nx">siteName</span><span class="si">}</span><span class="sb">, you are visitor number </span><span class="si">${</span><span class="nx">visitorNumber</span><span class="si">}</span><span class="sb">!`</span>
<span class="c1">// &quot;欢迎访问xxx，您是第xxxx位访问者！&quot;</span>
</pre></div>
</div>
<p>模板字符串本身并不能取代 <code class="docutils literal"><span class="pre">Mustache</span></code> 之类的模板库，因为没有条件判断和循环处理功能，但是通过标签函数，你可以自己添加这些功能。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="c1">// 下面的hashTemplate函数</span>
<span class="c1">// 是一个自定义的模板处理函数</span>
<span class="kd">let</span> <span class="nx">libraryHtml</span> <span class="o">=</span> <span class="nx">hashTemplate</span><span class="sb">`</span>
<span class="sb">  &lt;ul&gt;</span>
<span class="sb">    #for book in </span><span class="si">${</span><span class="nx">myBooks</span><span class="si">}</span><span class="sb"></span>
<span class="sb">      &lt;li&gt;&lt;i&gt;#{book.title}&lt;/i&gt; by #{book.author}&lt;/li&gt;</span>
<span class="sb">    #end</span>
<span class="sb">  &lt;/ul&gt;</span>
<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
<p>除此之外，你甚至可以使用标签模板，在 <code class="docutils literal"><span class="pre">JavaScript</span></code> 语言之中嵌入其他语言。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">jsx</span><span class="sb">`</span>
<span class="sb">  &lt;div&gt;</span>
<span class="sb">    &lt;input</span>
<span class="sb">      ref=&#39;input&#39;</span>
<span class="sb">      onChange=&#39;</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">handleChange</span><span class="si">}</span><span class="sb">&#39;</span>
<span class="sb">      defaultValue=&#39;</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">&#39; /&gt;</span>
<span class="sb">      </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb"></span>
<span class="sb">   &lt;/div&gt;</span>
<span class="sb">`</span>
</pre></div>
</div>
<p>上面的代码通过 <code class="docutils literal"><span class="pre">jsx</span></code> 函数，将一个 <code class="docutils literal"><span class="pre">DOM</span></code> 字符串转为 <code class="docutils literal"><span class="pre">React</span></code> 对象。你可以在 <code class="docutils literal"><span class="pre">Github</span></code> 找到 <code class="docutils literal"><span class="pre">jsx</span></code> 函数的具体实现。</p>
<p>下面则是一个假想的例子，通过 <code class="docutils literal"><span class="pre">java</span></code> 函数，在 <code class="docutils literal"><span class="pre">JavaScript</span></code> 代码之中运行 <code class="docutils literal"><span class="pre">Java</span></code> 代码。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">java</span><span class="sb">`</span>
<span class="sb">class HelloWorldApp {</span>
<span class="sb">  public static void main(String[] args) {</span>
<span class="sb">    System.out.println(“Hello World!”); // Display the string.</span>
<span class="sb">  }</span>
<span class="sb">}</span>
<span class="sb">`</span>
<span class="nx">HelloWorldApp</span><span class="p">.</span><span class="nx">main</span><span class="p">();</span>
</pre></div>
</div>
<p>模板处理函数的第一个参数（模板字符串数组），还有一个 <code class="docutils literal"><span class="pre">raw</span></code> 属性。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="sb">`123`</span>
<span class="c1">// [&quot;123&quot;, raw: Array[1]]</span>
</pre></div>
</div>
<p>上面代码中， <code class="docutils literal"><span class="pre">console.log</span></code> 接受的参数，实际上是一个数组。该数组有一个 <code class="docutils literal"><span class="pre">raw</span></code> 属性，保存的是转义后的原字符串。</p>
<p>请看下面的例子。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>tag`First line\nSecond line`

function tag(strings) {
  console.log(strings.raw[0]);
  // strings.raw[0] 为 &quot;First line\\nSecond line&quot;
  // 打印输出 &quot;First line\nSecond line&quot;
}
</pre></div>
</div>
<p>上面代码中， <code class="docutils literal"><span class="pre">tag</span></code> 函数的第一个参数 <code class="docutils literal"><span class="pre">strings</span></code> ，有一个 <code class="docutils literal"><span class="pre">raw</span></code> 属性，也指向一个数组。该数组的成员与 <code class="docutils literal"><span class="pre">strings</span></code> 数组完全一致。比如， <code class="docutils literal"><span class="pre">strings</span></code> 数组是 <code class="docutils literal"><span class="pre">[&quot;First</span> <span class="pre">line\nSecond</span> <span class="pre">line&quot;]</span></code> ，那么 <code class="docutils literal"><span class="pre">strings.raw</span></code> 数组就是 <code class="docutils literal"><span class="pre">[&quot;First</span> <span class="pre">line\\nSecond</span> <span class="pre">line&quot;]</span></code> 。两者唯一的区别，就是字符串里面的斜杠都被转义了。比如， <code class="docutils literal"><span class="pre">strings.raw</span></code> 数组会将 <code class="docutils literal"><span class="pre">\n</span></code> 视为 <code class="docutils literal"><span class="pre">\\</span></code> 和 <code class="docutils literal"><span class="pre">n</span></code> 两个字符，而不是换行符。这是为了方便取得转义之前的原始模板而设计的。</p>
</div>
<div class="section" id="string-raw">
<h2><a class="toc-backref" href="#id25">5.14. String.raw()</a><a class="headerlink" href="#string-raw" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ES6</span></code> 还为原生的 <code class="docutils literal"><span class="pre">String</span></code> 对象，提供了一个 <code class="docutils literal"><span class="pre">raw</span></code> 方法。</p>
<p><code class="docutils literal"><span class="pre">String.raw</span></code> 方法，往往用来充当模板字符串的处理函数，返回一个斜杠都被转义（即斜杠前面再加一个斜杠）的字符串，对应于替换变量后的模板字符串。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>String.raw`Hi\n${2+3}!`;
// 返回 &quot;Hi\\n5!&quot;

String.raw`Hi\u000A!`;
// 返回 &quot;Hi\\u000A!&quot;
</pre></div>
</div>
<p>如果原字符串的斜杠已经转义，那么 <code class="docutils literal"><span class="pre">String.raw</span></code> 会进行再次转义。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">String</span><span class="p">.</span><span class="nx">raw</span><span class="sb">`Hi\\n`</span>
<span class="c1">// 返回 &quot;Hi\\\\n&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">String.raw</span></code> 方法可以作为处理模板字符串的基本方法，它会将所有变量替换，而且对斜杠进行转义，方便下一步作为字符串来使用。</p>
<p><code class="docutils literal"><span class="pre">String.raw</span></code> 方法也可以作为正常的函数使用。这时，它的第一个参数，应该是一个具有 <code class="docutils literal"><span class="pre">raw</span></code> 属性的对象，且 <code class="docutils literal"><span class="pre">raw</span></code> 属性的值应该是一个数组。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">String</span><span class="p">.</span><span class="nx">raw</span><span class="p">({</span> <span class="nx">raw</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span> <span class="p">},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="c1">// &#39;t0e1s2t&#39;</span>

<span class="c1">// 等同于</span>
<span class="nb">String</span><span class="p">.</span><span class="nx">raw</span><span class="p">({</span> <span class="nx">raw</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="p">},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p>作为函数， <code class="docutils literal"><span class="pre">String.raw</span></code> 的代码实现基本如下。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nb">String</span><span class="p">.</span><span class="nx">raw</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">strings</span><span class="p">,</span> <span class="p">...</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">index</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">raw</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="nx">output</span> <span class="o">+=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">raw</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id26">5.15. 模板字符串的限制</a><a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<p>前面提到标签模板里面，可以内嵌其他语言。但是，模板字符串默认会将字符串转义，导致无法嵌入其他语言。</p>
<p>举例来说，标签模板里面可以嵌入 <code class="docutils literal"><span class="pre">LaTEX</span></code> 语言。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>function latex(strings) {
  // ...
}

let document = latex`
\newcommand{\fun}{\textbf{Fun!}}  // 正常工作
\newcommand{\unicode}{\textbf{Unicode!}} // 报错
\newcommand{\xerxes}{\textbf{King!}} // 报错

Breve over the h goes \u{h}ere // 报错
`
</pre></div>
</div>
<p>上面代码中，变量 <code class="docutils literal"><span class="pre">document</span></code> 内嵌的模板字符串，对于 <code class="docutils literal"><span class="pre">LaTEX</span></code> 语言来说完全是合法的，但是 <code class="docutils literal"><span class="pre">JavaScript</span></code> 引擎会报错。原因就在于字符串的转义。</p>
<p>模板字符串会将 <code class="docutils literal"><span class="pre">\u00FF</span></code> 和 <code class="docutils literal"><span class="pre">\u{42}</span></code> 当作 <code class="docutils literal"><span class="pre">Unicode</span></code> 字符进行转义，所以 <code class="docutils literal"><span class="pre">\unicode</span></code> 解析时报错；而 <code class="docutils literal"><span class="pre">\x56</span></code> 会被当作十六进制字符串转义，所以 <code class="docutils literal"><span class="pre">\xerxes</span></code> 会报错。也就是说， <code class="docutils literal"><span class="pre">\u</span></code> 和 <code class="docutils literal"><span class="pre">\x</span></code> 在 <code class="docutils literal"><span class="pre">LaTEX</span></code> 里面有特殊含义，但是 <code class="docutils literal"><span class="pre">JavaScript</span></code> 将它们转义了。</p>
<p>为了解决这个问题， <code class="docutils literal"><span class="pre">ES2018</span></code> 放松了对标签模板里面的字符串转义的限制。如果遇到不合法的字符串转义，就返回 <code class="docutils literal"><span class="pre">undefined</span></code> ，而不是报错，并且从 <code class="docutils literal"><span class="pre">raw</span></code> 属性上面可以得到原始字符串。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>function tag(strs) {
  strs[0] === undefined
  strs.raw[0] === &quot;\\unicode and \\u{55}&quot;;
}
tag`\unicode and \u{55}`
</pre></div>
</div>
<p>上面代码中，模板字符串原本是应该报错的，但是由于放松了对字符串转义的限制，所以不报错了， <code class="docutils literal"><span class="pre">JavaScript</span></code> 引擎将第一个字符设置为 <code class="docutils literal"><span class="pre">undefined</span></code> ，但是 <code class="docutils literal"><span class="pre">raw</span></code> 属性依然可以得到原始字符串，因此 <code class="docutils literal"><span class="pre">tag</span></code> 函数还是可以对原字符串进行处理。</p>
<p>注意，这种对字符串转义的放松，只在标签模板解析字符串时生效，不是标签模板的场合，依然会报错。</p>
<div class="highlight-js"><div class="highlight"><pre><span></span>let bad = `bad escape sequence: \unicode`; // 报错
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="正则的扩展.html" class="btn btn-neutral float-right" title="6. 正则的扩展" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="变量的解构赋值.html" class="btn btn-neutral" title="4. 变量的解构赋值" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, lzh.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            LANGUAGE:'zh_CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();

      });


      $(document).ready(function(){
        var offset = sessionStorage.getItem("offsetTop");
        $('.wy-side-scroll').scrollTop(offset);
        sessionStorage.setItem("offsetTop", 0);


        $('.wy-menu > ul').click(function(){
            sessionStorage.setItem("offsetTop", $('.wy-side-scroll').scrollTop());
        });
      })

  </script>
   

</body>
</html>